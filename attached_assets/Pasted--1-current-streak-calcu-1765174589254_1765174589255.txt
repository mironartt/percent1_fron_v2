  1. Как считается метрика "Дней подряд" (current_streak)?

  Метрика рассчитывается в методе _calculate_habit_streak() в core/models/globals.py:2762-2821.

  Алгоритм расчета:

  1. Начинается с сегодняшнего дня и идет назад в прошлое
  2. Для каждого дня:
    - Определяется день недели (0=Вс, 1=Пн, ..., 6=Сб)
    - Находятся все привычки, запланированные на этот день (проверка schedule_days)
    - Если в этот день нет запланированных привычек - день пропускается, переходим к предыдущему
    - Если есть запланированные привычки:
        - Проверяется, что ВСЕ запланированные привычки выполнены (статус completed)
      - Если да - streak += 1, переходим к предыдущему дню
      - Если нет - серия прерывается, возвращается текущее значение streak
  3. Ограничение: максимум 1000 дней для предотвращения бесконечного цикла

  Важные особенности:

  - Это серия ПОЛНОГО выполнения всех привычек, а не отдельных привычек
  - Дни без запланированных привычек НЕ прерывают серию (пропускаются)
  - Если хотя бы одна привычка не выполнена в запланированный день - серия прерывается
  - Учитываются только дни, где что-то было запланировано

  Пример:
  Пользователь имеет 3 привычки:
  - Зарядка: [1,3,5] (Пн, Ср, Пт)
  - Вода: [1,2,3,4,5,6] (Пн-Сб)
  - Медитация: [1,5] (Пн, Пт)

  Сегодня - Пятница (день 5):
  - Запланировано: Зарядка, Вода, Медитация (все 3)
  - Выполнено: Зарядка ✓, Вода ✓, Медитация ✓
  - Streak = 1

  Вчера - Четверг (день 4):
  - Запланировано: Вода
  - Выполнено: Вода ✓
  - Streak = 2

  Позавчера - Среда (день 3):
  - Запланировано: Зарядка, Вода
  - Выполнено: Зарядка ✓, Вода ✗ (ПРОПУЩЕНО)
  - Серия прерывается! Финальный streak = 2

  2. Блок активных привычек со статистикой за 30 дней

  Текущее состояние бэкенда:

  Метод get_habit_statistics() в core/models/globals.py:2482-2760 УЖЕ ВОЗВРАЩАЕТ корректные данные для этого блока в поле habits_data:

  'habits_data': [
      {
          'habit_id': int,
          'name': str,
          'icon': str,
          'completion_rate_7': int,   # Процент выполнения за 7 дней
          'completion_rate_30': int,  # Процент выполнения за 30 дней
          'streak': int,              # Серия для конкретной привычки
          'total_completions': int,   # Всего выполнений за период
      }
  ]

  Как рассчитывается для каждой привычки:

  1. completion_rate_7 (строки 2584-2593):
    - Берутся последние 7 дней
    - Для каждого дня проверяется, запланирована ли привычка (по schedule_days)
    - Считается процент: (выполнено / запланировано) * 100
  2. completion_rate_30 (строки 2596-2605):
    - То же самое, но за последние 30 дней
  3. streak (строка 2608):
    - Вызывается _calculate_habit_streak_for_habit() (строки 2823-2861)
    - Похожая логика на общий streak, но только для одной привычки
    - Идет назад от сегодня, считает дни подряд выполнения этой конкретной привычки
  4. total_completions (строка 2617):
    - Количество записей HabitCompletion со статусом completed за весь запрошенный период

  Вывод: Бэкенд полностью корректен для блока активных привычек. API endpoint /api/rest/front/app/habits/analytics/get/ возвращает все необходимые данные в поле habits_data.

  ---
  Рекомендации для фронтенда:

  Используйте данные из response.data.habits_data для отображения блока активных привычек:

  interface HabitData {
      habit_id: number
      name: string
      icon: string
      completion_rate_7: number    // Для отображения процента за неделю
      completion_rate_30: number   // Для отображения процента за месяц
      streak: number               // Серия дней для привычки
      total_completions: number    // Всего выполнений
  }

  Никаких доработок бэкенда не требуется - все данные уже передаются корректно.