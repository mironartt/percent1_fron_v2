# API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –†–∞–∑–¥–µ–ª "–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è" (Rewards/XP)

## –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ë—ç–∫–µ–Ω–¥ –æ–±–Ω–æ–≤–ª—ë–Ω –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø–æ–ª–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —Ä–∞–∑–¥–µ–ª–∞ "–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è":
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –Ω–∞–≥—Ä–∞–¥–∞–º–∏ (wishlist) - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–∏—Å–∫, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, —Ä–∞—Å—á—ë—Ç –±–ª–∏–∑–æ—Å—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–µ
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è XP —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ —Ç–∏–ø–∞–º –∏ –¥–∞—Ç–∞–º
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π XP (–∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ/–ø–æ—Ç—Ä–∞—á–µ–Ω–æ)

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### XP (Experience Points)

–°–∏—Å—Ç–µ–º–∞ –æ–ø—ã—Ç–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
- `xp_balance` - —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å XP (–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Ç—Ä–∞—Ç)
- `lifetime_xp` - –≤—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ XP –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç XP –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–µ–∫, –¥–Ω–µ–≤–Ω–∏–∫–∞, —Ü–µ–ª–µ–π
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç—Ä–∞—Ç–∏—Ç XP –Ω–∞ –Ω–∞–≥—Ä–∞–¥—ã (rewards)

### –ù–∞–≥—Ä–∞–¥—ã (Rewards)

Wishlist –Ω–∞–≥—Ä–∞–¥, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞—ë—Ç –¥–ª—è —Å–µ–±—è:
- –ö–∞–∂–¥–∞—è –Ω–∞–≥—Ä–∞–¥–∞ –∏–º–µ–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ XP
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–æ–ø–∏—Ç XP –∏ "–ø–æ–∫—É–ø–∞–µ—Ç" –Ω–∞–≥—Ä–∞–¥—ã
- –°—Ç–∞—Ç—É—Å—ã: `available` (–¥–æ—Å—Ç—É–ø–Ω–∞), `redeemed` (–ø–æ–ª—É—á–µ–Ω–∞)

### –ò—Å—Ç–æ—Ä–∏—è XP

–ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –∑–∞—á–∏—Å–ª–µ–Ω–∏–π –∏ —Å–ø–∏—Å–∞–Ω–∏–π XP —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π:
- –ü–æ –¥–Ω—è–º (—Å–∞–º—ã–µ –Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
- –í–Ω—É—Ç—Ä–∏ –¥–Ω—è - –ø–æ —Ç–∏–ø–∞–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ù–∞–≥—Ä–∞–¥—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è

---

## –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –Ω–∞–≥—Ä–∞–¥ (—Å –ø–æ–∏—Å–∫–æ–º –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π)

**URL:** `POST /api/rest/front/app/habits/rewards/get/`

**Request:**
```json
{
  "status_filter": "available",        // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: 'available' | 'redeemed' | null (–≤—Å–µ)
  "include_deleted": false,             // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –≤–∫–ª—é—á–∏—Ç—å —É–¥–∞–ª—ë–Ω–Ω—ã–µ (soft-delete)
  "query_filter": "–∫–Ω–∏–≥–∞",              // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é/–æ–ø–∏—Å–∞–Ω–∏—é (–º–∏–Ω 2 —Å–∏–º–≤–æ–ª–∞)
  "order_by": "distance_to_afford",     // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: 'cost' | 'distance_to_afford' | 'date_created'
  "order_direction": "asc"              // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: 'asc' | 'desc'
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `status_filter` - —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –Ω–∞–≥—Ä–∞–¥—ã
- `query_filter` - –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—é (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞, –º–∞–∫—Å–∏–º—É–º 200)
- `order_by` - –ø–æ–ª–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏:
  - `cost` - –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
  - `distance_to_afford` - –ø–æ –±–ª–∏–∑–æ—Å—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–µ (—Å–∫–æ–ª—å–∫–æ XP –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç)
  - `date_created` - –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è
- `order_direction` - –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: `asc` (–ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é), `desc` (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)

**Response:**
```json
{
  "status": "ok",
  "data": {
    "rewards": [
      {
        "reward_id": 1,
        "name": "–ù–æ–≤–∞—è –∫–Ω–∏–≥–∞",
        "cost": 100,
        "icon": "üìö",
        "description": "–ö–Ω–∏–≥–∞ –ø–æ —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏—é",
        "status": "available",
        "date_created": "2024-12-01 10:30:00",
        "date_redeemed": null,
        "xp_remaining": 25,          // NEW! –°–∫–æ–ª—å–∫–æ XP –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç (0 –µ—Å–ª–∏ —Ö–≤–∞—Ç–∞–µ—Ç)
        "can_afford": false          // NEW! –ú–æ–∂–Ω–æ –ª–∏ –∫—É–ø–∏—Ç—å (xp_balance >= cost)
      },
      {
        "reward_id": 2,
        "name": "–ü–æ—Ö–æ–¥ –≤ –∫–∏–Ω–æ",
        "cost": 50,
        "icon": "üé¨",
        "description": "",
        "status": "available",
        "date_created": "2024-11-28 14:15:00",
        "date_redeemed": null,
        "xp_remaining": 0,           // NEW! –•–≤–∞—Ç–∞–µ—Ç XP
        "can_afford": true           // NEW! –ú–æ–∂–Ω–æ –∫—É–ø–∏—Ç—å
      }
    ],
    "total_items": 10,               // NEW! –í—Å–µ–≥–æ –Ω–∞–≥—Ä–∞–¥ (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤)
    "total_filtered_items": 2,       // NEW! –° —É—á—ë—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤
    "current_balance": 75            // NEW! –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å XP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  }
}
```

**–í–∞–∂–Ω–æ:**
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `distance_to_afford` + `asc` = —Å–Ω–∞—á–∞–ª–∞ —Ç–µ –Ω–∞–≥—Ä–∞–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –±–ª–∏–∂–µ –≤—Å–µ–≥–æ –∫ –ø–æ–∫—É–ø–∫–µ
- `xp_remaining` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ XP –Ω—É–∂–Ω–æ –µ—â—ë –Ω–∞–∫–æ–ø–∏—Ç—å (0 –µ—Å–ª–∏ —É–∂–µ —Ö–≤–∞—Ç–∞–µ—Ç)
- `can_afford` - —É–¥–æ–±–Ω—ã–π —Ñ–ª–∞–≥ –¥–ª—è UI (–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–∏ –∫–Ω–æ–ø–∫—É "–ö—É–ø–∏—Ç—å")

**–ü—Ä–∏–º–µ—Ä—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–æ–∫:**

```javascript
// –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—ã –æ—Ç —Å–∞–º–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ–π –∫ –ø–æ–∫—É–ø–∫–µ
{
  order_by: 'distance_to_afford',
  order_direction: 'asc'
}

// –ü–æ–∫–∞–∑–∞—Ç—å —Å–∞–º—ã–µ –¥–æ—Ä–æ–≥–∏–µ –Ω–∞–≥—Ä–∞–¥—ã —Å–≤–µ—Ä—Ö—É
{
  order_by: 'cost',
  order_direction: 'desc'
}

// –ü–æ–∫–∞–∑–∞—Ç—å –Ω–µ–¥–∞–≤–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã
{
  order_by: 'date_created',
  order_direction: 'desc'
}
```

---

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥—ã

**URL:** `POST /api/rest/front/app/habits/rewards/create/`

**Request:**
```json
{
  "name": "–ù–æ–≤–∞—è –∫–Ω–∏–≥–∞",              // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
  "cost": 100,                        // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ (XP)
  "icon": "üìö",                       // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, default: 'üéÅ'
  "description": "–ö–Ω–∏–≥–∞ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é"  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
}
```

**Response:**
```json
{
  "status": "ok",
  "data": {
    "reward_id": 15
  }
}
```

---

### 3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥—ã

**URL:** `POST /api/rest/front/app/habits/rewards/update/`

**Request:**
```json
{
  "reward_id": 15,                    // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
  "name": "–û–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ",     // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  "cost": 120,                        // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  "icon": "üìñ",                       // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  "description": "–ù–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ"     // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
}
```

**Response:**
```json
{
  "status": "ok",
  "data": {
    "success": true
  }
}
```

---

### 4. –£–¥–∞–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥—ã

**URL:** `POST /api/rest/front/app/habits/rewards/delete/`

**Request:**
```json
{
  "reward_id": 15,       // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
  "permanent": false     // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: true = –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ, false = soft-delete
}
```

**Response:**
```json
{
  "status": "ok",
  "data": {
    "success": true
  }
}
```

**–í–∞–∂–Ω–æ:**
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `permanent=false` - –Ω–∞–≥—Ä–∞–¥–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ —É–¥–∞–ª—ë–Ω–Ω–∞—è (soft-delete)
- –° `permanent=true` - –Ω–∞–≥—Ä–∞–¥–∞ —É–¥–∞–ª—è–µ—Ç—Å—è –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ –∏–∑ –ë–î

---

### 5. –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥—ã (–ø–æ–∫—É–ø–∫–∞ –∑–∞ XP)

**URL:** `POST /api/rest/front/app/habits/rewards/redeem/`

**Request:**
```json
{
  "reward_id": 2  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
}
```

**Response (—É—Å–ø–µ—Ö):**
```json
{
  "status": "ok",
  "data": {
    "success": true,
    "new_balance": 25  // –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å XP –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏
  }
}
```

**Response (–æ—à–∏–±–∫–∞):**
```json
{
  "status": "ok",
  "data": {
    "success": false,
    "error": "insufficient_xp"  // –ò–ª–∏ –¥—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞
  }
}
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- `insufficient_xp` - –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ XP
- `reward_not_found` - –Ω–∞–≥—Ä–∞–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
- `already_redeemed` - –Ω–∞–≥—Ä–∞–¥–∞ —É–∂–µ –ø–æ–ª—É—á–µ–Ω–∞

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Ö–≤–∞—Ç–∞–µ—Ç –ª–∏ XP (`xp_balance >= reward.cost`)
2. –°–ø–∏—Å—ã–≤–∞–µ—Ç XP —Å –±–∞–ª–∞–Ω—Å–∞
3. –ú–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞–≥—Ä–∞–¥—ã –Ω–∞ `redeemed`
4. –°–æ–∑–¥–∞—ë—Ç XP —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Ç–∏–ø–∞ `reward_redeemed`

---

### 6. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è XP —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**URL:** `POST /api/rest/front/app/habits/xp/history-grouped/`

**Request:**
```json
{
  "transaction_status_filter": "earned",  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: 'earned' | 'spent' | null (–≤—Å–µ)
  "transaction_category_filter": "habits",  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: 'habits' | 'diary' | 'planning' | 'rewards' | 'goals' | 'other' | null
  "query_filter": "–∑–∞—Ä—è–¥–∫–∞",              // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—è–º –ø—Ä–∏–≤—ã—á–µ–∫/–Ω–∞–≥—Ä–∞–¥
  "page": 1,                              // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, default: 1
  "page_size": 10                         // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, default: 10, min: 5, max: 50
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

`transaction_status_filter` - —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É –æ–ø–µ—Ä–∞—Ü–∏–∏:
- `earned` - —Ç–æ–ª—å–∫–æ –∑–∞—á–∏—Å–ª–µ–Ω–∏—è (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ)
- `spent` - —Ç–æ–ª—å–∫–æ —Å–ø–∏—Å–∞–Ω–∏—è (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ)
- `null` - –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

`transaction_category_filter` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
- `habits` - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø—Ä–∏–≤—ã—á–∫–∞–º–∏
- `diary` - –∑–∞ –¥–Ω–µ–≤–Ω–∏–∫
- `planning` - —à—Ç—Ä–∞—Ñ—ã –∑–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- `rewards` - –ø–æ–∫—É–ø–∫–∏ –Ω–∞–≥—Ä–∞–¥
- `goals` - –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–µ–π
- `other` - –æ—Å—Ç–∞–ª—å–Ω–æ–µ

`query_filter` - –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ø—Ä–∏–≤—ã—á–∫–∏ –∏–ª–∏ –Ω–∞–≥—Ä–∞–¥—ã (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)

`page` / `page_size` - –ø–∞–≥–∏–Ω–∞—Ü–∏—è –ø–æ –¥–Ω—è–º (–Ω–µ –ø–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º!)

**Response:**
```json
{
  "status": "ok",
  "data": {
    "history_groups": [
      {
        "date": "2024-12-10",
        "total_earned": 50,         // –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ XP –∑–∞ –¥–µ–Ω—å
        "total_spent": 20,          // –í—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ XP –∑–∞ –¥–µ–Ω—å
        "net_change": 30,           // –ß–∏—Å—Ç–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ (–∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ - –ø–æ—Ç—Ä–∞—á–µ–Ω–æ)
        "groups": [
          {
            "group_type": "habit_completed",
            "group_type_display": "–ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–µ–∫ –∑–∞ –¥–µ–Ω—å",
            "total_amount": 30,      // –°—É–º–º–∞ XP –≤ –≥—Ä—É–ø–ø–µ
            "count": 3,              // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
            "items": [
              {
                "transaction_id": 145,
                "transaction_type": "habit_completed",
                "transaction_type_display": "–ü—Ä–∏–≤—ã—á–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞",
                "amount": 10,
                "habit_name": "–ó–∞—Ä—è–¥–∫–∞ 10 –º–∏–Ω",
                "reward_name": null,
                "metadata": {},
                "date_created": "2024-12-10 08:30:00"
              },
              // ... –µ—â—ë 2 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
            ]
          },
          {
            "group_type": "reward_redeemed",
            "group_type_display": "–¢—Ä–∞—Ç—ã –Ω–∞ \"–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è\"",
            "total_amount": -20,
            "count": 1,
            "items": [
              {
                "transaction_id": 150,
                "transaction_type": "reward_redeemed",
                "transaction_type_display": "–ü–æ–ª—É—á–µ–Ω–∞ –Ω–∞–≥—Ä–∞–¥–∞",
                "amount": -20,
                "habit_name": null,
                "reward_name": "–ü–æ—Ö–æ–¥ –≤ –∫–∏–Ω–æ",  // –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥—ã
                "metadata": {},
                "date_created": "2024-12-10 19:45:00"
              }
            ]
          }
        ]
      },
      {
        "date": "2024-12-09",
        "total_earned": 40,
        "total_spent": 5,
        "net_change": 35,
        "groups": [...]
      }
      // ... –µ—â—ë –¥–Ω–∏ (page_size –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é = 10)
    ],
    "total_items": 45,                  // –í—Å–µ–≥–æ –¥–Ω–µ–π –≤ –∏—Å—Ç–æ—Ä–∏–∏ (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤)
    "total_filtered_items": 20,         // –° —É—á—ë—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤
    "total_pages": 2,                   // –í—Å–µ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü
    "page": 1,                          // –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    "page_size": 10                     // –†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  }
}
```

**–í–∞–∂–Ω–æ:**
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏–¥—ë—Ç –ø–æ –¥–Ω—è–º (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
- –í–Ω—É—Ç—Ä–∏ –¥–Ω—è - –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–∏–ø–∞–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- **–ù–∞–≥—Ä–∞–¥—ã** (`reward_redeemed`) –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ - –∫–∞–∂–¥–∞—è –ø–æ–∫—É–ø–∫–∞ –Ω–∞–≥—Ä–∞–¥—ã –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ `items`
- **–û—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã** (–ø—Ä–∏–≤—ã—á–∫–∏, –¥–Ω–µ–≤–Ω–∏–∫, —Ü–µ–ª–∏) –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ–±—â–∞—è —Å—É–º–º–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å—á–∏—Ç–∞–µ—Ç **–¥–Ω–∏**, –∞ –Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (page_size=10 = 10 –¥–Ω–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ)

**–¢–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ –∏—Ö –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞:**

```
–ó–∞—á–∏—Å–ª–µ–Ω–∏—è (earned):
‚îú‚îÄ habit_completed ‚Üí "–ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–µ–∫ –∑–∞ –¥–µ–Ω—å" (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–æ)
‚îú‚îÄ journal_entry ‚Üí "–ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞" (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–æ)
‚îú‚îÄ goal_step_completed ‚Üí "–ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–æ–≤ –Ω–∞ –¥–µ–Ω—å" (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–æ)
‚îú‚îÄ goal_completed ‚Üí "–ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ü–µ–ª–∏" (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–æ)
‚îú‚îÄ achievement_bonus ‚Üí "–ë–æ–Ω—É—Å –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ" (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–æ)
‚îî‚îÄ manual_adjustment ‚Üí "–û—Å—Ç–∞–ª—å–Ω–æ–µ" (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–æ)

–°–ø–∏—Å–∞–Ω–∏—è (spent):
‚îú‚îÄ habit_penalty ‚Üí "–®—Ç—Ä–∞—Ñ –∑–∞ –ù–ï –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–µ–∫ –∑–∞ –¥–µ–Ω—å" (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–æ)
‚îú‚îÄ planning_penalty ‚Üí "–®—Ç—Ä–∞—Ñ –∑–∞ –ù–ï –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞" (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–æ)
‚îú‚îÄ journal_penalty ‚Üí "–®—Ç—Ä–∞—Ñ –∑–∞ –ù–ï –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–æ–≤ –Ω–∞ –¥–µ–Ω—å" (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–æ)
‚îú‚îÄ reward_redeemed ‚Üí "–¢—Ä–∞—Ç—ã –Ω–∞ \"–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è\"" (–ò–ù–î–ò–í–ò–î–£–ê–õ–¨–ù–û - –∫–∞–∂–¥–∞—è –Ω–∞–≥—Ä–∞–¥–∞ –æ—Ç–¥–µ–ª—å–Ω–æ!)
‚îî‚îÄ manual_adjustment ‚Üí "–û—Å—Ç–∞–ª—å–Ω–æ–µ" (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–æ)
```

**–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:**

```javascript
// –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ XP
{
  transaction_status_filter: 'earned',
  page: 1,
  page_size: 10
}

// –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç—Ä–∞—Ç—ã –Ω–∞ –Ω–∞–≥—Ä–∞–¥—ã
{
  transaction_status_filter: 'spent',
  transaction_category_filter: 'rewards',
  page: 1
}

// –ù–∞–π—Ç–∏ –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø—Ä–∏–≤—ã—á–∫–æ–π "–ó–∞—Ä—è–¥–∫–∞"
{
  query_filter: '–ó–∞—Ä—è–¥–∫–∞',
  page: 1
}

// –ò—Å—Ç–æ—Ä–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–Ω–∏ (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤)
{
  page: 1,
  page_size: 10
}
```

---

## UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

### –í–µ—Ä—Ö–Ω–∏–π –±–∞—Ä (XP —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)

–î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è XP —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —ç–Ω–¥–ø–æ–∏–Ω—Ç:

**URL:** `POST /api/rest/front/app/habits/xp/stats/`

**Response:**
```json
{
  "status": "ok",
  "data": {
    "xp_balance": 75,          // –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
    "lifetime_xp": 500,        // –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ
    "today_xp": 15,            // –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è
    "week_xp": 120             // –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞ –Ω–µ–¥–µ–ª—é
  }
}
```

### –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –±–ª–æ–∫ (—Å–ø–∏—Å–æ–∫ –Ω–∞–≥—Ä–∞–¥)

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç `GET /app/habits/rewards/get/` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

**–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é (–±–ª–∏–∂–µ –≤—Å–µ–≥–æ –∫ –ø–æ–∫—É–ø–∫–µ):**
```javascript
{
  status_filter: 'available',
  order_by: 'distance_to_afford',
  order_direction: 'asc'
}
```

**–ü–æ–∏—Å–∫:**
```javascript
{
  status_filter: 'available',
  query_filter: searchText,  // –ò–∑ –ø–æ–ª—è –ø–æ–∏—Å–∫–∞
  order_by: 'distance_to_afford',
  order_direction: 'asc'
}
```

**–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:**
```javascript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –≤ UI
const sortOptions = {
  'closest': { order_by: 'distance_to_afford', order_direction: 'asc' },
  'cheapest': { order_by: 'cost', order_direction: 'asc' },
  'expensive': { order_by: 'cost', order_direction: 'desc' },
  'newest': { order_by: 'date_created', order_direction: 'desc' }
};
```

### –ù–∏–∂–Ω–∏–π –±–ª–æ–∫ (–∏—Å—Ç–æ—Ä–∏—è XP)

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç `POST /app/habits/xp/history-grouped/` —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π:

**–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
```javascript
{
  page: 1,
  page_size: 10
}
```

**–§–∏–ª—å—Ç—Ä—ã:**
```javascript
// –¢–æ–ª—å–∫–æ –∑–∞—á–∏—Å–ª–µ–Ω–∏—è
{ transaction_status_filter: 'earned', page: 1 }

// –¢–æ–ª—å–∫–æ —Ç—Ä–∞—Ç—ã
{ transaction_status_filter: 'spent', page: 1 }

// –¢–æ–ª—å–∫–æ –ø—Ä–∏–≤—ã—á–∫–∏
{ transaction_category_filter: 'habits', page: 1 }

// –ö–æ–º–±–∏–Ω–∞—Ü–∏—è
{
  transaction_status_filter: 'spent',
  transaction_category_filter: 'rewards',
  page: 1
}
```

**–ü–æ–∏—Å–∫:**
```javascript
{
  query_filter: searchText,  // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—è–º –ø—Ä–∏–≤—ã—á–µ–∫/–Ω–∞–≥—Ä–∞–¥
  page: 1
}
```

**–ü–∞–≥–∏–Ω–∞—Ü–∏—è:**
```javascript
// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
{
  page: currentPage + 1,
  page_size: 10,
  // + –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
}
```

---

## –¢–∏–ø–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è"

```javascript
// 1. –ü–æ–ª—É—á–∏—Ç—å XP —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –≤–µ—Ä—Ö–Ω–µ–≥–æ –±–∞—Ä–∞
const xpStats = await api.post('/app/habits/xp/stats/');

// 2. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –Ω–∞–≥—Ä–∞–¥ (–ø–æ –±–ª–∏–∑–æ—Å—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–µ)
const rewards = await api.post('/app/habits/rewards/get/', {
  status_filter: 'available',
  order_by: 'distance_to_afford',
  order_direction: 'asc'
});

// 3. –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é XP (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
const history = await api.post('/app/habits/xp/history-grouped/', {
  page: 1,
  page_size: 10
});

// –¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
// - xpStats.data - –¥–ª—è –≤–µ—Ä—Ö–Ω–µ–≥–æ –±–∞—Ä–∞
// - rewards.data.rewards - —Å–ø–∏—Å–æ–∫ –Ω–∞–≥—Ä–∞–¥
// - rewards.data.current_balance - —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
// - history.data.history_groups - –∏—Å—Ç–æ—Ä–∏—è –ø–æ –¥–Ω—è–º
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–∫—É–ø–∫–∞ –Ω–∞–≥—Ä–∞–¥—ã

```javascript
// 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º can_afford –ø–µ—Ä–µ–¥ –ø–æ–∫—É–ø–∫–æ–π (–≤ –¥–∞–Ω–Ω—ã—Ö –Ω–∞–≥—Ä–∞–¥—ã)
if (!reward.can_afford) {
  showError('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ XP');
  return;
}

// 2. –ü–æ–∫—É–ø–∞–µ–º –Ω–∞–≥—Ä–∞–¥—É
const result = await api.post('/app/habits/rewards/redeem/', {
  reward_id: reward.reward_id
});

if (!result.data.success) {
  showError(result.data.error);
  return;
}

// 3. –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏
// –ú–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —á–∞—Å—Ç–∏ –∏–ª–∏ –≤—Å—é —Å—Ç—Ä–∞–Ω–∏—Ü—É:

// –û–±–Ω–æ–≤–∏—Ç—å XP —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
const newXpStats = await api.post('/app/habits/xp/stats/');

// –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–∞–≥—Ä–∞–¥ (–Ω–∞–≥—Ä–∞–¥–∞ –∏—Å—á–µ–∑–Ω–µ—Ç –∏–∑ available)
const newRewards = await api.post('/app/habits/rewards/get/', {
  status_filter: 'available',
  order_by: 'distance_to_afford',
  order_direction: 'asc'
});

// –û–±–Ω–æ–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é (—Ç–∞–º –ø–æ—è–≤–∏—Ç—Å—è –Ω–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è)
const newHistory = await api.post('/app/habits/xp/history-grouped/', {
  page: 1,
  page_size: 10
});
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –Ω–∞–≥—Ä–∞–¥—ã

```javascript
// –°–æ–∑–¥–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É
const newReward = await api.post('/app/habits/rewards/create/', {
  name: '–ù–æ–≤–∞—è –∫–Ω–∏–≥–∞',
  cost: 100,
  icon: 'üìö',
  description: '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –∫–Ω–∏–≥–∞'
});

// –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–∞–≥—Ä–∞–¥
const rewards = await api.post('/app/habits/rewards/get/', {
  status_filter: 'available',
  order_by: 'distance_to_afford',
  order_direction: 'asc'
});
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏ XP

```javascript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª —Ñ–∏–ª—å—Ç—Ä "–¢–æ–ª—å–∫–æ –∑–∞—á–∏—Å–ª–µ–Ω–∏—è"
const history = await api.post('/app/habits/xp/history-grouped/', {
  transaction_status_filter: 'earned',
  page: 1,
  page_size: 10
});

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª "–¢–æ–ª—å–∫–æ —Ç—Ä–∞—Ç—ã –Ω–∞ –Ω–∞–≥—Ä–∞–¥—ã"
const rewardsHistory = await api.post('/app/habits/xp/history-grouped/', {
  transaction_status_filter: 'spent',
  transaction_category_filter: 'rewards',
  page: 1,
  page_size: 10
});

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤—ë–ª –ø–æ–∏—Å–∫
const searchResults = await api.post('/app/habits/xp/history-grouped/', {
  query_filter: '–∑–∞—Ä—è–¥–∫–∞',
  page: 1,
  page_size: 10
});
```

---

## –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### –†–∞—Å—á—ë—Ç XP

**–ó–∞—á–∏—Å–ª–µ–Ω–∏—è (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ):**
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏: `habit.xp_reward`
- –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫)
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —à–∞–≥–∞ —Ü–µ–ª–∏: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ü–µ–ª–∏: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
- –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ (–±–µ–π–¥–∂): –±–æ–Ω—É—Å XP

**–°–ø–∏—Å–∞–Ω–∏—è (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ):**
- –ü—Ä–æ–ø—É—Å–∫ –ø—Ä–∏–≤—ã—á–∫–∏: `habit.xp_penalty * penalty_multiplier` (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∂–∏–º–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏)
- –®—Ç—Ä–∞—Ñ –∑–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: `habit_settings.planning_penalty_amount` (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
- –®—Ç—Ä–∞—Ñ –∑–∞ –¥–Ω–µ–≤–Ω–∏–∫: `habit_settings.journal_penalty_amount` (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
- –ü–æ–∫—É–ø–∫–∞ –Ω–∞–≥—Ä–∞–¥—ã: `reward.cost`

### –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤ –∏—Å—Ç–æ—Ä–∏–∏

**–ù–∞–≥—Ä–∞–¥—ã (`reward_redeemed`) - –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ:**
```json
{
  "group_type": "reward_redeemed",
  "count": 3,  // 3 —Ä–∞–∑–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã –∫—É–ø–ª–µ–Ω—ã –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å
  "items": [
    { "reward_name": "–ö–∏–Ω–æ", "amount": -50 },
    { "reward_name": "–ö–Ω–∏–≥–∞", "amount": -100 },
    { "reward_name": "–ö–æ—Ñ–µ", "amount": -20 }
  ]
}
```

**–ü—Ä–∏–≤—ã—á–∫–∏ - –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–æ:**
```json
{
  "group_type": "habit_completed",
  "count": 5,  // 5 –ø—Ä–∏–≤—ã—á–µ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
  "total_amount": 50,  // –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ
  "items": [
    { "habit_name": "–ó–∞—Ä—è–¥–∫–∞", "amount": 10 },
    { "habit_name": "–ß—Ç–µ–Ω–∏–µ", "amount": 10 },
    { "habit_name": "–ú–µ–¥–∏—Ç–∞—Ü–∏—è", "amount": 10 },
    { "habit_name": "–í–æ–¥–∞", "amount": 10 },
    { "habit_name": "–ü—Ä–æ–≥—É–ª–∫–∞", "amount": 10 }
  ]
}
```

### –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä–∞–¥ –ø–æ –±–ª–∏–∑–æ—Å—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–µ

–õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ `xp_remaining`:
```python
xp_remaining = max(0, reward.cost - user.xp_balance)
```

–ü—Ä–∏–º–µ—Ä—ã:
- –ù–∞–≥—Ä–∞–¥–∞ —Å—Ç–æ–∏—Ç 100 XP, –±–∞–ª–∞–Ω—Å 75 XP ‚Üí `xp_remaining = 25`, `can_afford = false`
- –ù–∞–≥—Ä–∞–¥–∞ —Å—Ç–æ–∏—Ç 50 XP, –±–∞–ª–∞–Ω—Å 75 XP ‚Üí `xp_remaining = 0`, `can_afford = true`

–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ `distance_to_afford` + `asc`:
1. –°–Ω–∞—á–∞–ª–∞ –Ω–∞–≥—Ä–∞–¥—ã —Å `xp_remaining = 0` (–º–æ–∂–Ω–æ –∫—É–ø–∏—Ç—å)
2. –ü–æ—Ç–æ–º —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º `xp_remaining` (–±–ª–∏–∂–µ –≤—Å–µ–≥–æ –∫ –ø–æ–∫—É–ø–∫–µ)
3. –ü–æ—Ç–æ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–≥–æ XP

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ API

```json
{
  "status": "error",
  "error_code": "XIGRewGet5k_SOME_ERROR",
  "error_message": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏"
}
```

### –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –Ω–∞–≥—Ä–∞–¥

–ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –Ω–∞–≥—Ä–∞–¥—ã (`/rewards/redeem/`):

```json
{
  "status": "ok",
  "data": {
    "success": false,
    "error": "insufficient_xp"  // –∏–ª–∏ –¥—Ä—É–≥–æ–π –∫–æ–¥
  }
}
```

–ö–æ–¥—ã –æ—à–∏–±–æ–∫:
- `insufficient_xp` - –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ XP –¥–ª—è –ø–æ–∫—É–ø–∫–∏
- `reward_not_found` - –Ω–∞–≥—Ä–∞–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∞
- `already_redeemed` - –Ω–∞–≥—Ä–∞–¥–∞ —É–∂–µ –±—ã–ª–∞ –ø–æ–ª—É—á–µ–Ω–∞ —Ä–∞–Ω–µ–µ

### –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `query_filter`:
- –ú–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞
- –ú–∞–∫—Å–∏–º—É–º 200 —Å–∏–º–≤–æ–ª–æ–≤
- –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤–µ—Ä–Ω—ë—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π error response

---

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–ü–∞–≥–∏–Ω–∞—Ü–∏—è –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Å—á–∏—Ç–∞–µ—Ç –¥–Ω–∏, –∞ –Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - `page_size=10` –∑–Ω–∞—á–∏—Ç 10 –¥–Ω–µ–π, –∞ –Ω–µ 10 –∑–∞–ø–∏—Å–µ–π

2. **–ù–∞–≥—Ä–∞–¥—ã –≤ –∏—Å—Ç–æ—Ä–∏–∏ –≤—Å–µ–≥–¥–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã** - –∫–∞–∂–¥–∞—è –ø–æ–∫—É–ø–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–ª, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –∫—É–ø–∏–ª

3. **Soft-delete –¥–ª—è –Ω–∞–≥—Ä–∞–¥** - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞–≥—Ä–∞–¥—ã –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞, –∞ –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ —É–¥–∞–ª—ë–Ω–Ω—ã–µ. –ú–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É

4. **–†–∞—Å—á—ë—Ç –±–ª–∏–∑–æ—Å—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–µ** - –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î —á–µ—Ä–µ–∑ Django –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

5. **–ë–∞–ª–∞–Ω—Å XP –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º** - –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ XP –±–∞–ª–∞–Ω—Å –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω—É–ª—ë–º: `max(0, balance - amount)`

6. **Lifetime XP —Ä–∞—Å—Ç—ë—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–∞—á–∏—Å–ª–µ–Ω–∏—è—Ö** - —Å–ø–∏—Å–∞–Ω–∏—è –Ω–µ —É–º–µ–Ω—å—à–∞—é—Ç lifetime_xp, —Ç–æ–ª—å–∫–æ balance

7. **–¢–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã** - —Å–ø–∏—Å–æ–∫ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–µ `XP_TRANSACTION_TYPES` –≤ `core/models/habits.py`

---

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏

–ï—Å–ª–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –Ω–∞–≥—Ä–∞–¥—ã:

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `GET /app/habits/rewards/get/`:

**–ë—ã–ª–æ:**
```json
{
  "status": "ok",
  "data": {
    "rewards": [...]  // –ü—Ä–æ—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
  }
}
```

**–°—Ç–∞–ª–æ:**
```json
{
  "status": "ok",
  "data": {
    "rewards": [...],           // –° –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏ xp_remaining, can_afford
    "total_items": 10,          // NEW!
    "total_filtered_items": 8,  // NEW!
    "current_balance": 75       // NEW!
  }
}
```

**–ß—Ç–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å:**
- –î–∞–Ω–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥ —Ç–µ–ø–µ—Ä—å –≤ `response.data.rewards` (–±—ã–ª–æ `response.data.rewards`)
- –ö–∞–∂–¥–∞—è –Ω–∞–≥—Ä–∞–¥–∞ –∏–º–µ–µ—Ç –Ω–æ–≤—ã–µ –ø–æ–ª—è `xp_remaining` –∏ `can_afford`
- –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: `total_items`, `total_filtered_items`, `current_balance`

### –ù–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç:

`POST /app/habits/xp/history-grouped/` - –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–æ–≤—ã–π, —Ä–∞–Ω–µ–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Ä–∞–∑–¥–µ–ª–µ "–¢–∏–ø–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏"
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–º–∏–Ω/–º–∞–∫—Å –¥–ª–∏–Ω—ã, –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥—ã –æ—à–∏–±–æ–∫ –≤ response

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã, –∫—Ä–æ–º–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã response –≤ `GET /rewards/get/` (—Å–º. —Ä–∞–∑–¥–µ–ª "–ú–∏–≥—Ä–∞—Ü–∏—è").