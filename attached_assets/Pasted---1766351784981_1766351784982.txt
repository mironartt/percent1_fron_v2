Планируется реализовать реферальную систему и интегрировать ее с бэкендом.

Сейчс частично уже готово (страница в настройках ЛК и отдельная: `app/referral`), но не интегрировано с бэком.


Как это работает, для пользователя:
- Поделитесь ссылкой
Отправьте свою реферальную ссылку друзьям
- Друг регистрируется
Ваш друг создаёт аккаунт по вашей ссылке
- Получаете награду
Вы получаете 30% от первой оплаты друга

Это глобальный формат работы реферальной системы.  
Выплаты будут происходить руками через менеджеров.  

Давай определимся с терминами:
- реферер - пользователь предоставивший код
- реферал - пользователь воспользовавшийся кодом

----

Для бэкенд разработки я сформулировал задачу так:

>>>>>
Тезисы:
- У пользователя должна быть реферальная сылка, пример: `https://percent1.ru/ref/demo123`. Также должна поддерживаться и с GET параметрами `https://percent1.ru/?ref=demo123`.
- по открытие данного линка, фронт будет ставить куку, или хранить в своем локал-сторадже данные, что это пользователь (анонимный) пришел по реферальному коду такому-то...
- после регистрации данного пользователя (именно регистрации, не авторизации, т.е. рефералка работает только на новых пользователях) для данного пользователя ставится пометка что он реферал такого-то пользователя (понять по указанному реф-коду который передаст фронт во время регистрации).
- в ЛК у пользователя (реферера) будет страница с данными по его реферальной системе (к примеру страница `/app/referral`)
на данной старнице будет отображаться:
    - Приглашено друзей
    - Заработано денег
    - возможные реферальные ссылки
    - рассчет возможного дохода при оплате его рефералом одного из доступных тарифов (нужно прикладывать данные по текущим активным тарифам)
    - мои рефералы. Это блок где будет выводиться таблица с рефералами данного пользователя. В ней будут отображаться email пользователя, когда он зарегистрировался по указанной ссылке, и также будет столбец показывающий была ли совершена данным рефералом реальная оплата.  
    Т.е. отображаться будут все зарегистированные по реф.коду, и дополнительно будет отображаться был ли у данного пользователя реальный платеж (т.к. только после реального платежа будет начисление рефереру)
    - блок вывода средств. Для пользователя возможно запросить вывод (это создание заявки в админку) средств, в размере не менее 3000 руб. Если у пользователя меньше доступный баланс, то ему не доступен вывод.
- заработок для реферера начисляется только при первой реальной покупке его рефералов, в размере 30% от их первой траты. 
Т.е. примеры:
  - если его реферал выполнил первую покупку тарифа на 1 месяц за 990, то ему (рефереру) будет начислено на реферальный баланс 990*0.3=297
  - если его реферал выполнил первую покупку тарифа на 12 месяц, и суммарная его оплата составил 25116, то ему (рефереру) будет начислено на реферальный баланс 25116*0.3=7534,8 -> округляем в меньшую сторону = 7534 рублей.
- нужна модель с заявками пользователей рефереров на вывод средств с их реферального баланса. Она также должна быть в админке
- нужно где-то хранить модель с транзакциям пополнения реферального баланса пользователя или произведенного списания (это все должно также быть доступным в админке)
В транзакциях нужно связывать все сущности, если это пополнение за платеж реферала, то должно быть связан: объект билинга, реферал и тд....
- в админке полагаю нужен отдельный раздел реферальная система или что-то подобное

<<<<<

----  

Бэкенд закончил работу, и предоставли документ для интеграции: `referral_system.md` (приложен к сообщению)

Получается есть два формата ссылок:
- Прямая: `https://percent1.ru/ref/A1B2C3D4E5F6`
- Query: `https://percent1.ru/?ref=A1B2C3D4E5F6`

Если пользователь не авторизован, то фронт должен при обнаружение ссылки:
- прямой - получить `referral_code` из урла и сохранить в локал-сторадж, и средиректить на страницу регистрации, после во время регистрации ничего не меняется, лишь добавляется в запрос поле с кодом реферала.
- query - получить `referral_code` из GET параметров код, и также сохранить его в локал-сторадже. Редиректов не делать, но если пользоваетль будет регистрироваться, то добавить в запрос код реферала.

Если остались вопросы задавай.