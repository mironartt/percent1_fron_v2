–í–µ—Ä–Ω–µ–º—Å—è –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

–¢–≤–æ—è –∑–∞–¥–∞—á–∞:
- —É–±—Ä–∞—Ç—å –∫–Ω–æ–ø–∫—É "google" - —ç—Ç–æ –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ–º –¥–µ–ª–∞—Ç—å, —Å–¥–µ–ª–∞—é –ø–æ–∑–∂–µ
- –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –º–æ—é –ª–æ–≥–∏–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∫ –∫–Ω–æ–ø–∫–µ "telegram"

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram"
2. Telegram –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
3. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ —Å–∞–π—Ç
4. –°–∞–π—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
5. –°–æ–∑–¥–∞–µ—Ç/–Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç

–Ø –∏—Å–ø–æ–ª—å–∑—É—é –ø–æ–¥—Ö–æ–¥ –≤ –≤–∏–¥–µ: –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ (–∫–∞—Å—Ç–æ–º–Ω—ã–π –¥–∏–∑–∞–π–Ω)

**–°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã:**
```
–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞ (–∫–Ω–æ–ø–∫–∞-—Å—Å—ã–ª–∫–∞)
    ‚Üì
oauth.telegram.org (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)
    ‚Üì
–í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞ (#tgAuthResult –≤ —Ö–µ—à–µ)
    ‚Üì
JavaScript –¥–µ–∫–æ–¥–∏—Ä—É–µ—Ç —Ö–µ—à –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç
    ‚Üì
Django callback (/telegram/auth/callback/?id=...&hash=...)
    ‚Üì
–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è + —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /app/
```

**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤:** 3

----

–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ç—ã –¥–æ–ª–∂–µ–Ω –±—É–¥–µ—à—å –¥–æ–ø–æ–ª–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã –∫–Ω–æ–ø–∫–∏ "Telegram".
–û–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—É–¥–µ—Ç –≤–µ—Å—Ç–∏ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π —É—Ä–ª.

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É—Ä–ª–∞, —è –¥–æ–±–∞–≤–∏–ª —ç–Ω–¥–ø–æ–∏–Ω—Ç: `/api/rest/front/get-global-data/`
–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```
    // –û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å –∫ API
    function callApi() {
      const url = 'http://127.0.0.1:8017/api/rest/front/get-global-data/';
      const data = {};
      const headers = {
    // "Authorization": "Bearer <–≤–∞—à_—Ç–æ–∫–µ–Ω>",
    "Content-Type": "application/json"
};

      return fetch(url, {
        method: 'POST',
        credentials: 'same-origin',
        headers: headers,
        body: JSON.stringify(data),
      })
        .then(response => response.json())
        .then(data => {
        console.log('Response:', data);
      })
        .catch(error => {
        console.error('Error:', error);
      });
    }

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: —Å–Ω–∞—á–∞–ª–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º CSRF, –ø–æ—Ç–æ–º –≤—ã–∑—ã–≤–∞–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç
initCsrf()
  .then(() => callApi())
  .catch(console.error);
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```
{
    "status": "ok",
    "data": {
        "t_auth_link": "https://oauth.telegram.org/auth?bot_id=8073846126&origin=https://4cb22700-a529-46b3-bb4b-a6a0b736d9dd.tunnel4.com&request_access=write&return_to=https://4cb22700-a529-46b3-bb4b-a6a0b736d9dd.tunnel4.com/telegram/test/login/"
        "t_auth_callback_url": "https://4cb22700-a529-46b3-bb4b-a6a0b736d9dd.tunnel4.com/telegram/auth/callback/"
    }
}
```
–ü–æ–ª—É—á–µ–Ω–Ω—ã–π `t_auth_link` –∏ –µ—Å—Ç—å –ª–∏–Ω–∫ –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–≤–µ—Ä—à–µ–Ω –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –¥–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É. –û—Ç–º–µ—á—É, —á—Ç–æ —ç—Ç–æ—Ç –ª–∏–Ω–∫ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å –∏–º–µ–Ω–Ω–æ —á–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç, —Ç.–∫. –æ–Ω –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è.
–ê `t_auth_callback_url` —ç—Ç–æ —É—Ä–ª –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Å–ª–µ —Ñ—Ä–æ–Ω—Ç—É –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Å—Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–∏.

–¢–∞–∫–∂–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ª–æ–∂–µ–Ω JS –∫–æ–¥ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è –∏–∑ —Ç–µ–ª–µ–≥—Ä–∞–º–∞, —è –ø—Ä–∏–ª–æ–∂—É –ø—Ä–∏–º–µ—Ä –º–æ–µ–π —Ç–µ—Å—Ç–æ–≤–æ–π html —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π —è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ —Ç–µ–ª–µ–≥—Ä–∞–º:
```
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–í—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram</title>
</head>
<body>
    <h1>ü§ñ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h1>

    <!-- –ö–Ω–æ–ø–∫–∞-—Å—Å—ã–ª–∫–∞ -->
    <a href="https://oauth.telegram.org/auth?bot_id={{ bot_id }}&origin={{ origin|urlencode }}&request_access=write&return_to={{ return_to|urlencode }}"
       class="telegram-btn">
        üîê –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram
    </a>
    <script>
        // üî¥ JavaScript –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ö–µ—à–∞
        (function() {
            console.log('üîµ Checking for auth result...');
            console.log('Current hash:', window.location.hash);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ö–µ—à–µ
            if (window.location.hash.startsWith('#tgAuthResult=')) {
                console.log('‚úÖ Found tgAuthResult in hash');

                try {
                    // –ò–∑–≤–ª–µ–∫–∞–µ–º –∏ –¥–µ–∫–æ–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
                    const base64Data = window.location.hash.substring('#tgAuthResult='.length);
                    const jsonString = atob(base64Data);
                    const authData = JSON.parse(jsonString);

                    console.log('‚úÖ Decoded auth data:', authData);

                    // –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è callback —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ query
                    const params = new URLSearchParams(authData);
                    const callbackUrl = '{{ callback_url }}?' + params.toString();

                    console.log('üì§ Redirecting to:', callbackUrl);

                    // –†–µ–¥–∏—Ä–µ–∫—Ç–∏–º –Ω–∞ Django callback
                    window.location.href = callbackUrl;

                } catch (error) {
                    console.error('‚ùå Error processing auth data:', error);
                    alert('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
                }
            } else {
                console.log('‚ÑπÔ∏è  No auth result in hash');
            }
        })();
    </script>
</body>
</html>
```
–¢.–µ. —Ç–µ–±–µ –Ω—É–∂–Ω–æ –ª–æ–≥–∏–∫—É –∏–∑ –¥–∞–Ω–Ω–æ–≥–æ –∫—É—Å–∫–∞ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—É `auth/login` –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ñ—Ä–æ–Ω—Ç–∞.
–ï—Å–ª–∏ –ø–æ–Ω—è–ª, —Ç–æ –ø—Ä–∏—Å—Ç—É–ø–∞–π –∫ —Ä–∞–±–æ—Ç–µ.