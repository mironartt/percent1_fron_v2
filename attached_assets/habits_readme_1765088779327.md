# –ú–æ–¥—É–ª—å "–ü—Ä–∏–≤—ã—á–∫–∏" –∏ "–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è"

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
3. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
4. [–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö](#–º–æ–¥–µ–ª–∏-–¥–∞–Ω–Ω—ã—Ö)
5. [API Endpoints](#api-endpoints)
6. [–ë–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã](#–±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã)
7. [–°–∏—Å—Ç–µ–º–∞ –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏–∏](#—Å–∏—Å—Ç–µ–º–∞-–≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏–∏)
8. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)

---

## –û–±–∑–æ—Ä

–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–≤—ã—á–µ–∫ —Å —Å–∏—Å—Ç–µ–º–æ–π –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏–∏, XP-–Ω–∞–≥—Ä–∞–¥–∞–º–∏ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è–º–∏. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–∏–≤—ã—á–∫–∏, –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –ø–æ–ª—É—á–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—ã –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ **–¢—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- üéÆ **–ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è** ‚Äî XP –Ω–∞–≥—Ä–∞–¥—ã/—à—Ç—Ä–∞—Ñ—ã, 4 —Ä–µ–∂–∏–º–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- üèÜ **–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è** ‚Äî 19 –±–µ–π–¥–∂–µ–π –≤ 4 –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö
- üìä **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –≥—Ä–∞—Ñ–∏–∫–∏, —Ç—Ä–µ–Ω–¥—ã
- üéÅ **–ù–∞–≥—Ä–∞–¥—ã** ‚Äî wishlist –Ω–∞–≥—Ä–∞–¥ –∑–∞ XP
- üî• **Streaks** ‚Äî —Å–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π –ø–æ–¥—Ä—è–¥
- üíù **–ê–º–Ω–∏—Å—Ç–∏—è** ‚Äî –ø—Ä–æ—â–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤
- üìà **–ò—Å—Ç–æ—Ä–∏—è XP** ‚Äî –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –†–∞–∑–¥–µ–ª "–ü—Ä–∏–≤—ã—á–∫–∏"

#### 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∞–º–∏
- –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è, –∏–∫–æ–Ω–∫–∏, XP, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- Soft-delete —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏—Å—Ç–æ—Ä–∏–∏
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫
- –í—ã–±–æ—Ä –∏–∑ 25 —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫

#### 2. –¢—Ä–µ–∫–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –û—Ç–º–µ—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è/–ø—Ä–æ–ø—É—Å–∫–∞/—É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ–ø—É—Å–∫–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ XP –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ XP –∑–∞ –ø—Ä–æ–ø—É—Å–∫–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é
- –£–∫–∞–∑–∞–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–ø—É—Å–∫–∞

#### 3. –†–µ–∂–∏–º—ã —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- **–ú—è–≥–∫–∏–π** ‚Äî —Ç–æ–ª—å–∫–æ –Ω–∞–≥—Ä–∞–¥—ã, –±–µ–∑ —à—Ç—Ä–∞—Ñ–æ–≤
- **–ë–∞–ª–∞–Ω—Å** ‚Äî 50% —à—Ç—Ä–∞—Ñ–æ–≤, 1 –∞–º–Ω–∏—Å—Ç–∏—è –≤ –Ω–µ–¥–µ–ª—é
- **–•–∞—Ä–¥–∫–æ—Ä** ‚Äî 100% —à—Ç—Ä–∞—Ñ–æ–≤, –±–µ–∑ –∞–º–Ω–∏—Å—Ç–∏–π
- **–°–≤–æ–π** ‚Äî –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

#### 4. –°–∏—Å—Ç–µ–º–∞ –∞–º–Ω–∏—Å—Ç–∏–π
- –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –ª–∏–º–∏—Ç –∞–º–Ω–∏—Å—Ç–∏–π
- –ü—Ä–æ—â–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –±–µ–∑ —à—Ç—Ä–∞—Ñ–∞
- –í–æ–∑–≤—Ä–∞—Ç XP –∑–∞ –∞–º–Ω–∏—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–Ω–∏
- –û—Ç–º–µ–Ω–∞ –∞–º–Ω–∏—Å—Ç–∏–∏

#### 5. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
- **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞ 7 –∏ 30 –¥–Ω–µ–π, —Ç—Ä–µ–Ω–¥ –∑–∞ 8 –Ω–µ–¥–µ–ª—å
- **–ö–∞–ª–µ–Ω–¥–∞—Ä—å** ‚Äî —Ç–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞ –≥–æ–¥
- **–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è** ‚Äî –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –≤—Å–µ–º –±–µ–π–¥–∂–∞–º
- **–ü–æ –ø—Ä–∏–≤—ã—á–∫–∞–º** ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–∂–¥–æ–π –ø—Ä–∏–≤—ã—á–∫–∏

---

### –†–∞–∑–¥–µ–ª "–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è"

#### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π

**1. –°–µ—Ä–∏–∏ (Streak) ‚Äî 7 –±–µ–π–¥–∂–µ–π**
- üå± –ü–µ—Ä–≤—ã–µ —Ä–æ—Å—Ç–∫–∏ ‚Äî 3 –¥–Ω—è –ø–æ–¥—Ä—è–¥
- üî• –ù–µ–¥–µ–ª—è –æ–≥–Ω—è ‚Äî 7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥
- ‚ö° –î–≤–µ –Ω–µ–¥–µ–ª–∏ —Å–∏–ª—ã ‚Äî 14 –¥–Ω–µ–π
- üß† –ü—Ä–∏–≤—ã—á–∫–∞ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∞ ‚Äî 21 –¥–µ–Ω—å
- üèÜ –ú–µ—Å—è—Ü —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ ‚Äî 30 –¥–Ω–µ–π
- üëë –ñ–µ–ª–µ–∑–Ω–∞—è –≤–æ–ª—è ‚Äî 50 –¥–Ω–µ–π
- üíé –õ–µ–≥–µ–Ω–¥–∞ ‚Äî 100 –¥–Ω–µ–π

**2. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (Completion) ‚Äî 4 –±–µ–π–¥–∂–∞**
- ‚ú® –ò–¥–µ–∞–ª—å–Ω–∞—è –Ω–µ–¥–µ–ª—è ‚Äî 100% –∑–∞ 7 –¥–Ω–µ–π
- üéØ –ü–æ—á—Ç–∏ –∏–¥–µ–∞–ª ‚Äî 80%+ –∑–∞ –Ω–µ–¥–µ–ª—é
- üìà –°—Ç–∞–±–∏–ª—å–Ω—ã–π –º–µ—Å—è—Ü ‚Äî 80%+ –∑–∞ 30 –¥–Ω–µ–π
- üåü –ò–¥–µ–∞–ª—å–Ω—ã–π –º–µ—Å—è—Ü ‚Äî 100% –∑–∞ 30 –¥–Ω–µ–π

**3. –û–±—ä—ë–º (Volume) ‚Äî 5 –±–µ–π–¥–∂–µ–π**
- üöÄ –ü–µ—Ä–≤—ã–π —à–∞–≥ ‚Äî 1 –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- üéñÔ∏è –î–µ—Å—è—Ç–∫–∞ ‚Äî 10 –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π
- üèÖ –ü–æ–ª—Å–æ—Ç–Ω–∏ ‚Äî 50 –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π
- ü•á –°–æ—Ç–Ω—è ‚Äî 100 –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π
- üèÜ –ú–∞—Å—Ç–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫ ‚Äî 500 –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π

**4. –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ (Variety) ‚Äî 3 –±–µ–π–¥–∂–∞**
- üåà –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ ‚Äî 3 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–∫–∏
- üé® –ë–æ–≥–∞—Ç—ã–π –∞—Ä—Å–µ–Ω–∞–ª ‚Äî 5 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫
- üåç –í—Å–µ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π —Ä–æ—Å—Ç ‚Äî 10 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫

#### –ú–µ—Ö–∞–Ω–∏–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —É—Å–ª–æ–≤–∏–π
- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
- –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞—Ç—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
core/
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ globals.py          # User –º–æ–¥–µ–ª—å —Å –º–µ—Ç–æ–¥–∞–º–∏ –ø—Ä–∏–≤—ã—á–µ–∫
‚îÇ   ‚îú‚îÄ‚îÄ habits.py           # –ú–æ–¥–µ–ª–∏: Habit, HabitCompletion, Achievement –∏ –¥—Ä.
‚îÇ   ‚îî‚îÄ‚îÄ user_data.py        # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ serializers/
‚îÇ   ‚îî‚îÄ‚îÄ habits.py           # –í—Å–µ serializers –¥–ª—è API
‚îú‚îÄ‚îÄ views/
‚îÇ   ‚îî‚îÄ‚îÄ drf/
‚îÇ       ‚îî‚îÄ‚îÄ front_api_methods/
‚îÇ           ‚îî‚îÄ‚îÄ habits.py   # –í—Å–µ API views
‚îî‚îÄ‚îÄ urls_front_api.py       # URL patterns
```

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Backend:** Django 4.x, DRF
- **–ë–î:** PostgreSQL (JSONField, ArrayField)
- **API:** REST, POST-only endpoints
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** Token/Session based
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** drf-spectacular (OpenAPI 3.0)

---

## –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏

#### User (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)
```python
xp_balance: int         # –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å XP
lifetime_xp: int        # –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ XP –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è
```

#### HabitSettings
```python
user                     # OneToOne —Å User
difficulty_mode          # 'soft', 'balanced', 'hardcore', 'custom'
penalty_multiplier       # Decimal(3,2), –º–Ω–æ–∂–∏—Ç–µ–ª—å —à—Ç—Ä–∞—Ñ–∞ (0-1)
weekly_amnesty_count     # int, –∞–º–Ω–∏—Å—Ç–∏–π –≤ –Ω–µ–¥–µ–ª—é (0-7)
amnestied_dates          # JSONField, —Å–ø–∏—Å–æ–∫ –¥–∞—Ç —Å –∞–º–Ω–∏—Å—Ç–∏–µ–π
planning_penalty_*       # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∞–Ω–∫—Ü–∏–∏
journal_penalty_*
```

#### Habit
```python
user                     # ForeignKey
name                     # CharField(100), –Ω–∞–∑–≤–∞–Ω–∏–µ
icon                     # CharField(50), choices –∏–∑ 32 –∏–∫–æ–Ω–æ–∫
xp_reward                # int, –Ω–∞–≥—Ä–∞–¥–∞ –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (1-100)
xp_penalty               # int, —à—Ç—Ä–∞—Ñ –∑–∞ –ø—Ä–æ–ø—É—Å–∫ (0-200)
frequency_type           # 'daily', 'weekdays', 'weekends', 'custom'
schedule_days            # JSONField, [0-6] –≥–¥–µ 0=–í—Å, 1=–ü–Ω
description              # TextField(500)
date_deleted             # DateTime, null=soft-delete
```

#### HabitCompletion
```python
habit                    # ForeignKey
user                     # ForeignKey
date                     # DateField
status                   # 'completed', 'missed', 'excused'
note                     # TextField, –∑–∞–º–µ—Ç–∫–∞
excuse_reason            # TextField, –ø—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–ø—É—Å–∫–∞
xp_earned                # int, –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ XP
xp_penalty               # int, —à—Ç—Ä–∞—Ñ XP
is_amnestied             # bool, –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∞–º–Ω–∏—Å—Ç–∏—è
```

#### XPTransaction
```python
user                     # ForeignKey
amount                   # int, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ XP (+ –∏–ª–∏ -)
transaction_type         # choices, 8 —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
habit                    # ForeignKey, optional
habit_completion         # ForeignKey, optional
achievement              # ForeignKey, optional
metadata                 # JSONField, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
balance_after            # int, –±–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
is_reversed              # bool, –æ—Ç–º–µ–Ω–µ–Ω–∞ –ª–∏
```

#### Achievement
```python
achievement_id           # CharField(50), unique
category                 # 'streak', 'completion', 'volume', 'variety'
icon                     # CharField(10), emoji
name                     # CharField(100)
description              # CharField(200)
target                   # int, —Ü–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
order                    # int, –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
```

#### UserAchievement
```python
user                     # ForeignKey
achievement              # ForeignKey
unlocked_at              # DateTime
```

#### Reward
```python
user                     # ForeignKey
name                     # CharField(200)
cost                     # int, —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ XP
icon                     # CharField(10), emoji
description              # TextField
status                   # 'available', 'redeemed'
date_redeemed            # DateTime, null
date_deleted             # DateTime, null
```

---

## API Endpoints

### –í—Å–µ–≥–æ: 18 endpoints

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (2)
- `POST /api/app/habits/settings/get/` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `POST /api/app/habits/settings/update/` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

#### –ü—Ä–∏–≤—ã—á–∫–∏ (2)
- `POST /api/app/habits/get/` ‚Äî —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–≤—ã—á–µ–∫ —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
- `POST /api/app/habits/update/` ‚Äî —Å–æ–∑–¥–∞—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫–∏

#### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (1)
- `POST /api/app/habits/completions/update/` ‚Äî –æ—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

#### –ê–º–Ω–∏—Å—Ç–∏—è (2)
- `POST /api/app/habits/amnesty/apply/` ‚Äî –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∞–º–Ω–∏—Å—Ç–∏—é
- `POST /api/app/habits/amnesty/revoke/` ‚Äî –æ—Ç–º–µ–Ω–∏—Ç—å –∞–º–Ω–∏—Å—Ç–∏—é

#### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (1)
- `POST /api/app/habits/analytics/get/` ‚Äî –ø–æ–ª–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

#### –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è (1)
- `POST /api/app/habits/achievements/get/` ‚Äî —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (2)
- `POST /api/app/habits/stats-panel/` ‚Äî –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏
- `POST /api/app/habits/recommended/` ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏

#### XP (2)
- `POST /api/app/habits/xp/history/` ‚Äî –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π XP
- `POST /api/app/habits/xp/stats/` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ XP

#### –ù–∞–≥—Ä–∞–¥—ã (5)
- `POST /api/app/habits/rewards/get/` ‚Äî —Å–ø–∏—Å–æ–∫ –Ω–∞–≥—Ä–∞–¥
- `POST /api/app/habits/rewards/create/` ‚Äî —Å–æ–∑–¥–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É
- `POST /api/app/habits/rewards/redeem/` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É
- `POST /api/app/habits/rewards/update/` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É
- `POST /api/app/habits/rewards/delete/` ‚Äî —É–¥–∞–ª–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É

---

## –ë–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏

**–§–ª–æ—É:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É"
2. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –≤—ã–±–∏—Ä–∞–µ—Ç –∏–∑ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã—Ö (`/recommended/`)
3. –ó–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É (–Ω–∞–∑–≤–∞–Ω–∏–µ, –∏–∫–æ–Ω–∫–∞, XP, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ)
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `POST /habits/update/` —Å `action: "create"`
5. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–∏–≤—ã—á–∫—É –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ID
6. –§—Ä–æ–Ω—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤—ã—á–∫—É –≤ —Å–ø–∏—Å–æ–∫

**–ê–≤—Ç–æ–º–∞—Ç–∏–∫–∞:**
- –ü—Ä–∏ `frequency_type="daily"` ‚Üí `schedule_days=[0,1,2,3,4,5,6]`
- –ü—Ä–∏ `frequency_type="weekdays"` ‚Üí `schedule_days=[1,2,3,4,5]`
- –ü—Ä–∏ `frequency_type="weekends"` ‚Üí `schedule_days=[0,6]`

### 2. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏

**–§–ª–æ—É:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É/–¥–µ–Ω—å
2. –§—Ä–æ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `POST /completions/update/`
3. –ë—ç–∫–µ–Ω–¥ —Å–æ–∑–¥–∞—ë—Ç HabitCompletion
4. –ë—ç–∫–µ–Ω–¥ –Ω–∞—á–∏—Å–ª—è–µ—Ç XP —á–µ—Ä–µ–∑ XPTransaction
5. –ë—ç–∫–µ–Ω–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è ‚Üí —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
6. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
7. –§—Ä–æ–Ω—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç UI

**–ê–≤—Ç–æ–º–∞—Ç–∏–∫–∞:**
- `xp_earned` = `habit.xp_reward`
- –°–æ–∑–¥–∞—ë—Ç—Å—è XPTransaction —Å —Ç–∏–ø–æ–º `habit_completed`
- `user.xp_balance` –∏ `user.lifetime_xp` –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –Ω–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫—É

### 3. –ü—Ä–æ–ø—É—Å–∫ –ø—Ä–∏–≤—ã—á–∫–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π)

**–¢—Ä–∏–≥–≥–µ—Ä:** –ù–∞—Å—Ç—É–ø–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –¥–Ω—è

**–§–ª–æ—É:**
1. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—á–µ—Ä–∞—à–Ω–∏–π –¥–µ–Ω—å
2. –î–ª—è –∫–∞–∂–¥–æ–π –ø—Ä–∏–≤—ã—á–∫–∏ —Å `schedule_days` –≤–∫–ª—é—á–∞—é—â–∏–º –≤—á–µ—Ä–∞—à–Ω–∏–π –¥–µ–Ω—å:
   - –ï—Å–ª–∏ –Ω–µ—Ç HabitCompletion ‚Üí —Å–æ–∑–¥–∞—ë—Ç —Å `status="missed"`
   - –ï—Å–ª–∏ —Ä–µ–∂–∏–º != 'soft' –ò –¥–µ–Ω—å –Ω–µ –≤ –∞–º–Ω–∏—Å—Ç–∏–∏:
     - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —à—Ç—Ä–∞—Ñ = `xp_penalty * penalty_multiplier`
     - –°–ø–∏—Å—ã–≤–∞–µ—Ç XP —á–µ—Ä–µ–∑ XPTransaction
     - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `completion.xp_penalty`

### 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∞–º–Ω–∏—Å—Ç–∏–∏

**–£—Å–ª–æ–≤–∏—è:**
- `difficulty_mode` != 'soft'
- `weekly_amnesty_count` > 0
- –ï—Å—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∞–º–Ω–∏—Å—Ç–∏–∏ –Ω–∞ –Ω–µ–¥–µ–ª–µ
- –ï—Å—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –¥–Ω–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π

**–§–ª–æ—É:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–π –¥–µ–Ω—å
2. –§—Ä–æ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `POST /amnesty/apply/` —Å –¥–∞—Ç–æ–π
3. –ë—ç–∫–µ–Ω–¥ –¥–æ–±–∞–≤–ª—è–µ—Ç –¥–∞—Ç—É –≤ `amnestied_dates`
4. –ë—ç–∫–µ–Ω–¥ –Ω–∞—Ö–æ–¥–∏—Ç –≤—Å–µ `missed` completions –∑–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å
5. –î–ª—è –∫–∞–∂–¥–æ–≥–æ:
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç XP —à—Ç—Ä–∞—Ñ–∞ —á–µ—Ä–µ–∑ XPTransaction
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `is_amnestied=True`
6. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

### 5. –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

**–¢—Ä–∏–≥–≥–µ—Ä:** –õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏)

**–§–ª–æ—É:**
1. –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
2. –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫–∞–∂–¥–æ–º—É –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—é
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:
   - –ï—Å–ª–∏ `progress >= target` ‚Üí —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç
   - –°–æ–∑–¥–∞—ë—Ç UserAchievement
   - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –Ω–∞—á–∏—Å–ª—è–µ—Ç –±–æ–Ω—É—Å XP
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π

---

## –°–∏—Å—Ç–µ–º–∞ –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –†–∞—Å—á—ë—Ç XP

**–ó–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:**
```python
XP_earned = habit.xp_reward  # 1-100
```

**–ó–∞ –ø—Ä–æ–ø—É—Å–∫:**
```python
XP_penalty = habit.xp_penalty * settings.penalty_multiplier  # 0-200

–≥–¥–µ penalty_multiplier:
- soft: 0
- balanced: 0.5
- hardcore: 1.0
- custom: –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π (0-1)
```

**–ë–∞–ª–∞–Ω—Å XP:**
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –æ–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∏–∂–µ 0
- `xp_balance` ‚Äî —Ç–µ–∫—É—â–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã–π XP
- `lifetime_xp` ‚Äî –≤—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ (—Ç–æ–ª—å–∫–æ —Ä–∞—Å—Ç—ë—Ç)

### –†–∞—Å—á—ë—Ç Streak

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```python
streak = 0
current_date = —Å–µ–≥–æ–¥–Ω—è

while True:
    if –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å –±—ã–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
        streak += 1
        current_date -= 1 –¥–µ–Ω—å
    elif –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å –±—ã–ª–∏ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏:
        break  # streak –ø—Ä–µ—Ä–≤–∞–Ω
    else:
        current_date -= 1 –¥–µ–Ω—å  # –¥–µ–Ω—å –±–µ–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
        
return streak
```

**–í–∞–∂–Ω–æ:** Streak —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–Ω–∏ —Å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏–≤—ã—á–∫–∞–º–∏

### –¢–∏–ø—ã XP —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

1. `habit_completed` ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ (+)
2. `habit_penalty` ‚Äî —à—Ç—Ä–∞—Ñ –∑–∞ –ø—Ä–æ–ø—É—Å–∫ (-)
3. `goal_step_completed` ‚Äî —à–∞–≥ —Ü–µ–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω (+)
4. `goal_completed` ‚Äî —Ü–µ–ª—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (+)
5. `journal_entry` ‚Äî –∑–∞–ø–∏—Å—å –≤ –¥–Ω–µ–≤–Ω–∏–∫ (+)
6. `achievement_bonus` ‚Äî –±–æ–Ω—É—Å –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ (+)
7. `reward_redeemed` ‚Äî –ø–æ–ª—É—á–µ–Ω–∞ –Ω–∞–≥—Ä–∞–¥–∞ (-)
8. `manual_adjustment` ‚Äî —Ä—É—á–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ (+/-)

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ

```python
# 1. –°–æ–∑–¥–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
POST /habits/settings/update/
{
    "difficulty_mode": "soft",  # –∏–ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    "weekly_amnesty_count": 0
}

# 2. –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏
POST /habits/recommended/
# –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞
```

### –ó–∞–≥—Ä—É–∑–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

```python
# 1. –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –ø–∞–Ω–µ–ª–∏
POST /habits/stats-panel/
# –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å: streak, —Å–µ–≥–æ–¥–Ω—è X/Y, XP –∑–∞ –Ω–µ–¥–µ–ª—é, –∞–º–Ω–∏—Å—Ç–∏–∏

# 2. –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫–∏ –∑–∞ —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é
POST /habits/get/
{
    "date_from": "2024-12-02",  # –Ω–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏
    "date_to": "2024-12-08"      # –∫–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏
}
# –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–≤—ã—á–µ–∫ —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
```

### –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –Ω–µ–¥–µ–ª—è–º

```python
# –ü—Ä–µ–¥—ã–¥—É—â–∞—è –Ω–µ–¥–µ–ª—è
POST /habits/get/
{
    "date_from": "2024-11-25",
    "date_to": "2024-12-01"
}

# –°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è
POST /habits/get/
{
    "date_from": "2024-12-09",
    "date_to": "2024-12-15"
}
```

### –û—Ç–∫—Ä—ã—Ç–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

```python
# –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É
POST /habits/analytics/get/

# –û—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:
# - completion_stats (–ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞ 7 –∏ 30 –¥–Ω–µ–π, —Ç—Ä–µ–Ω–¥ 8 –Ω–µ–¥–µ–ª—å)
# - calendar_data (heatmap –∑–∞ –≥–æ–¥)
# - habit_stats (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–∂–¥–æ–π –ø—Ä–∏–≤—ã—á–∫–µ)
```

### –†–∞–±–æ—Ç–∞ —Å –Ω–∞–≥—Ä–∞–¥–∞–º–∏

```python
# 1. –°–æ–∑–¥–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É –≤ wishlist
POST /rewards/create/
{
    "name": "–ö–æ—Ñ–µ –≤ –ª—é–±–∏–º–æ–π –∫–æ—Ñ–µ–π–Ω–µ",
    "cost": 50,
    "icon": "‚òï",
    "description": "–í–∫—É—Å–Ω—ã–π –∫–∞–ø—É—á–∏–Ω–æ"
}

# 2. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–∞–≥—Ä–∞–¥
POST /rewards/get/
{
    "status_filter": "available"
}

# 3. –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É –∑–∞ XP
POST /rewards/redeem/
{
    "reward_id": 123
}
# –°–ø–∏—Å—ã–≤–∞–µ—Ç XP, –º–µ–Ω—è–µ—Ç status –Ω–∞ 'redeemed'
```

---

## –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–∫—Å—Ç—É—Ä –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π

```bash
python manage.py loaddata achievements_fixtures.json
```

–ó–∞–≥—Ä—É–∂–∞–µ—Ç 19 –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π.

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

```bash
python manage.py makemigrations
python manage.py migrate
```

–°–æ–∑–¥–∞—ë—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
- habits_habitsettings
- habits_habit
- habits_habitcompletion
- habits_achievement
- habits_userachievement
- habits_xptransaction
- habits_reward

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**–ò–Ω–¥–µ–∫—Å—ã:**
- `(user, date_deleted)` –Ω–∞ Habit
- `(user, date)` –Ω–∞ HabitCompletion
- `(user, transaction_type)` –Ω–∞ XPTransaction
- `(user, achievement)` –Ω–∞ UserAchievement

**–î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è:**
- `xp_earned` –∏ `xp_penalty` –≤ HabitCompletion –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- `xp_balance` –∏ `lifetime_xp` –≤ User –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∞–≥—Ä–µ–≥–∞—Ü–∏–π

**–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ (–Ω–µ –º–µ–Ω—è—é—Ç—Å—è)
- –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π)

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞

- –í—Å–µ endpoints —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `user` –Ω–∞ —É—Ä–æ–≤–Ω–µ ORM
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö serializers

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- XP balance >= 0 (–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º)
- xp_reward: 1-100
- xp_penalty: 0-200
- weekly_amnesty_count: 0-7
- penalty_multiplier: 0-1

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ:**
- –ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Å–æ–∑–¥–∞–≤—à–∏—Ö >= 1 –ø—Ä–∏–≤—ã—á–∫–∏)
- –°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–≤—ã—á–µ–∫ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°—Ä–µ–¥–Ω–∏–π streak
- –ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏–≤—ã—á–µ–∫

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ:**
- –°–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ API endpoints
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π XP –≤ –¥–µ–Ω—å
- –ü—Ä–æ—Ü–µ–Ω—Ç —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –õ–æ–≥–∏

- –í—Å–µ XP —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ XPTransaction
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–≤—ã—á–µ–∫ —á–µ—Ä–µ–∑ date_updated
- –ò—Å—Ç–æ—Ä–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ unlocked_at

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

- Soft-delete –¥–ª—è –ø—Ä–∏–≤—ã—á–µ–∫ (date_deleted)
- Soft-delete –¥–ª—è –Ω–∞–≥—Ä–∞–¥ (date_deleted)
- –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è XP –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–º–µ–Ω—ã –∞–º–Ω–∏—Å—Ç–∏–∏

---

## –í–µ—Ä—Å–∏—è

**–¢–µ–∫—É—â–∞—è:** 2.0  
**–î–∞—Ç–∞:** –î–µ–∫–∞–±—Ä—å 2024  
**–°—Ç–∞—Ç—É—Å:** Production Ready ‚úÖ

---

## –ê–≤—Ç–æ—Ä—ã

–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞: –í–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞  
–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: AI Assistant  
–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 07.12.2024