# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –ø–∞–Ω–µ–ª–∏ (Stats Panel)

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 08.12.2025

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ API

–≠–Ω–¥–ø–æ–∏–Ω—Ç `/api/rest/front/app/habits/stats-panel/` –±—ã–ª –¥–æ–ø–æ–ª–Ω–µ–Ω –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–≤—É—Ö –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω: "XP –∑–∞ –ø—Ä–∏–≤—ã—á–∫–∏" –∏ "–°–µ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π".

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞

### URL
```
POST /api/rest/front/app/habits/stats-panel/
```

### Request
```json
{}
```
–ó–∞–ø—Ä–æ—Å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

### Response

```json
{
  "status": "ok",
  "data": {
    "streak": 5,
    "today_completed": 3,
    "today_total": 5,
    "week_xp": 120,
    "month_xp": 450,
    "week_xp_by_day": [
      {
        "date": "2025-12-08",
        "xp": 50
      },
      {
        "date": "2025-12-09",
        "xp": 30
      },
      {
        "date": "2025-12-10",
        "xp": 40
      }
    ],
    "streak_days": [
      {
        "date": "2025-12-08",
        "is_in_streak": true,
        "streak_count": 5,
        "is_scheduled": true
      },
      {
        "date": "2025-12-07",
        "is_in_streak": true,
        "streak_count": 4,
        "is_scheduled": true
      }
    ],
    "amnesty_remaining": 1,
    "difficulty_mode": "balanced"
  }
}
```

---

## –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª–µ–π

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `streak` | integer | –¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ (–≤—Å–µ –ø—Ä–∏–≤—ã—á–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã) |
| `today_completed` | integer | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫ —Å–µ–≥–æ–¥–Ω—è |
| `today_total` | integer | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫ —Å–µ–≥–æ–¥–Ω—è |
| `week_xp` | integer | –û–±—â–∏–π XP –∑–∞ —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é |
| `amnesty_remaining` | integer | –û—Å—Ç–∞–≤—à–µ–µ—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–º–Ω–∏—Å—Ç–∏–π –Ω–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é |
| `difficulty_mode` | string | –¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ ('soft', 'balanced', 'hardcore', 'custom') |

### –ù–æ–≤—ã–µ –ø–æ–ª—è

#### `month_xp` (integer)
–û–±—â–∏–π XP, –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü.

**–†–∞—Å—á–µ—Ç:**
```
month_xp = SUM(–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ –∑–∞ –º–µ—Å—è—Ü √ó xp_reward)
         - SUM(–ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ –∑–∞ –º–µ—Å—è—Ü √ó xp_penalty √ó penalty_multiplier)
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–ª—è –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫ —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω–æ–π –∞–º–Ω–∏—Å—Ç–∏–µ–π —à—Ç—Ä–∞—Ñ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è.

---

#### `week_xp_by_day` (array)
–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ XP –ø–æ –∫–∞–∂–¥–æ–º—É –¥–Ω—é —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —ç–ª–µ–º–µ–Ω—Ç–∞:**
```typescript
{
  date: string,  // –î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD
  xp: number     // –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π XP –∑–∞ –¥–µ–Ω—å (‚â• 0)
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ú–∞—Å—Å–∏–≤ —Å–æ–¥–µ—Ä–∂–∏—Ç 7 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–ø–Ω-–≤—Å —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏)
- XP –∑–∞ –¥–µ–Ω—å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å —É—á–µ—Ç–æ–º:
  - ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏: `+xp_reward`
  - ‚ùå –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏: `-xp_penalty √ó penalty_multiplier`
  - üõ°Ô∏è –ê–º–Ω–∏—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–ø—É—Å–∫–∏: —à—Ç—Ä–∞—Ñ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è
- XP –∑–∞ –¥–µ–Ω—å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º (min = 0)

**–ü—Ä–∏–º–µ—Ä:**
```json
[
  { "date": "2025-12-02", "xp": 35 },  // –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
  { "date": "2025-12-03", "xp": 50 },  // –í—Ç–æ—Ä–Ω–∏–∫
  { "date": "2025-12-04", "xp": 0 },   // –°—Ä–µ–¥–∞ (–Ω–∏—á–µ–≥–æ –Ω–µ –±—ã–ª–æ)
  { "date": "2025-12-05", "xp": 25 },  // –ß–µ—Ç–≤–µ—Ä–≥
  { "date": "2025-12-06", "xp": 40 },  // –ü—è—Ç–Ω–∏—Ü–∞
  { "date": "2025-12-07", "xp": 30 },  // –°—É–±–±–æ—Ç–∞
  { "date": "2025-12-08", "xp": 45 }   // –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
]
```

---

#### `streak_days` (array)
–°–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 30 –¥–Ω–µ–π —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —ç–ª–µ–º–µ–Ω—Ç–∞:**
```typescript
{
  date: string,         // –î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD
  is_in_streak: boolean, // –í—Ö–æ–¥–∏—Ç –ª–∏ –¥–µ–Ω—å –≤ —Å–µ—Ä–∏—é
  streak_count: number,  // –î–ª–∏–Ω–∞ —Å–µ—Ä–∏–∏ –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å (‚â• 0)
  is_scheduled: boolean  // –ï—Å—Ç—å –ª–∏ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å
}
```

**–õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞:**
- `is_in_streak = true` ‚Äî –µ—Å–ª–∏ –≤—Å–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å –ø—Ä–∏–≤—ã—á–∫–∏ –±—ã–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- `streak_count` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ –Ω–∞ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç (—Å—á–∏—Ç–∞–µ—Ç—Å—è –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è)
- `is_scheduled = false` ‚Äî –µ—Å–ª–∏ –Ω–∞ –¥–µ–Ω—å –Ω–µ –±—ã–ª–æ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –ø—Ä–∏–≤—ã—á–∫–∏ (—Ç–∞–∫–∏–µ –¥–Ω–∏ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç —Å–µ—Ä–∏—é)

**–ü—Ä–∏–º–µ—Ä:**
```json
[
  {
    "date": "2025-12-08",  // –°–µ–≥–æ–¥–Ω—è
    "is_in_streak": true,
    "streak_count": 5,     // 5 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç
    "is_scheduled": true
  },
  {
    "date": "2025-12-07",
    "is_in_streak": true,
    "streak_count": 4,     // 4 –¥–Ω—è –ø–æ–¥—Ä—è–¥ –Ω–∞ —Ç–æ—Ç –º–æ–º–µ–Ω—Ç
    "is_scheduled": true
  },
  {
    "date": "2025-12-06",
    "is_in_streak": true,
    "streak_count": 3,
    "is_scheduled": true
  },
  {
    "date": "2025-12-05",
    "is_in_streak": false,  // –î–µ–Ω—å –Ω–µ –≤ —Å–µ—Ä–∏–∏
    "streak_count": 0,
    "is_scheduled": true
  },
  {
    "date": "2025-12-04",
    "is_in_streak": false,  // –í—ã—Ö–æ–¥–Ω–æ–π –±–µ–∑ –ø—Ä–∏–≤—ã—á–µ–∫
    "streak_count": 0,
    "is_scheduled": false   // –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç —Å–µ—Ä–∏—é
  }
]
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ú–∞—Å—Å–∏–≤ –≤—Å–µ–≥–¥–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
- –î–Ω–∏ –∏–¥—É—Ç –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (–æ—Ç —Å–µ–≥–æ–¥–Ω—è –∫ –ø—Ä–æ—à–ª–æ–º—É)
- –î–Ω–∏ –±–µ–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (`is_scheduled = false`) –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç —Å–µ—Ä–∏—é
- `streak_count` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–ª–∏–Ω—É —Å–µ—Ä–∏–∏ **–Ω–∞ —Ç–æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–µ–Ω—å**

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

### –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "XP –∑–∞ –ø—Ä–∏–≤—ã—á–∫–∏"

–ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –±–ª–æ–∫ "XP –∑–∞ –ø—Ä–∏–≤—ã—á–∫–∏" –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:

**–û—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:**
1. **XP –∑–∞ –Ω–µ–¥–µ–ª—é**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–µ `week_xp`
2. **XP –∑–∞ –º–µ—Å—è—Ü**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–µ `month_xp`
3. **–ì—Ä–∞—Ñ–∏–∫ XP –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏**: –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `week_xp_by_day`

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
```javascript
// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
const statsData = await fetchHabitsStatsPanel()

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
modalData.value = {
  weekXP: statsData.week_xp,
  monthXP: statsData.month_xp,
  dailyStats: statsData.week_xp_by_day.map(day => ({
    date: formatDate(day.date),      // '8 –¥–µ–∫'
    xp: day.xp,
    dayName: getDayName(day.date)    // '–ü–Ω', '–í—Ç', ...
  }))
}
```

**UI —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–æ–ª–±—á–∞—Ç—É—é –¥–∏–∞–≥—Ä–∞–º–º—É –¥–ª—è `week_xp_by_day`
- –í—ã—Å–æ—Ç–∞ —Å—Ç–æ–ª–±—Ü–∞ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ `xp` –∑–∞ –¥–µ–Ω—å
- –ü–æ–¥–ø–∏—Å—å –ø–æ–¥ —Å—Ç–æ–ª–±—Ü–æ–º: –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏
- –í—Å–ø–ª—ã–≤–∞—é—â–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏: –¥–∞—Ç–∞ + XP

---

### –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–°–µ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π"

–ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –±–ª–æ–∫ "–î–Ω–µ–π –ø–æ–¥—Ä—è–¥" –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∏—Å—Ç–æ—Ä–∏–µ–π —Å–µ—Ä–∏–π:

**–û—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:**
1. **–¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–µ `streak`
2. **–ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 30 –¥–Ω–µ–π**: –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `streak_days`

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
```javascript
// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
const statsData = await fetchHabitsStatsPanel()

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
modalData.value = {
  currentStreak: statsData.streak,
  calendar: statsData.streak_days.map(day => ({
    date: day.date,
    isInStreak: day.is_in_streak,
    streakCount: day.streak_count,
    isScheduled: day.is_scheduled,
    displayClass: getDisplayClass(day)
  }))
}

function getDisplayClass(day) {
  if (!day.is_scheduled) return 'not-scheduled'  // –°–µ—Ä—ã–π
  if (day.is_in_streak) return 'in-streak'      // –ó–µ–ª–µ–Ω—ã–π
  return 'missed'                                 // –ö—Ä–∞—Å–Ω—ã–π
}
```

**UI —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –û—Ç–æ–±—Ä–∞–∂–∞–π—Ç–µ –¥–Ω–∏ –≤ –≤–∏–¥–µ –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ–π —Å–µ—Ç–∫–∏ (7 –∫–æ–ª–æ–Ω–æ–∫)
- –¶–≤–µ—Ç–æ–≤–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞:
  - üü¢ –ó–µ–ª–µ–Ω—ã–π: `is_in_streak = true` (–¥–µ–Ω—å –≤ —Å–µ—Ä–∏–∏)
  - üî¥ –ö—Ä–∞—Å–Ω—ã–π: `is_in_streak = false && is_scheduled = true` (–ø—Ä–æ–ø—É—Å–∫)
  - ‚ö™ –°–µ—Ä—ã–π: `is_scheduled = false` (–Ω–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ)
- –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –¥–µ–Ω—å –ø–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ:
  - –î–∞—Ç—É
  - –°—Ç–∞—Ç—É—Å (–≤ —Å–µ—Ä–∏–∏ / –ø—Ä–æ–ø—É—â–µ–Ω / –Ω–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω)
  - –î–ª–∏–Ω—É —Å–µ—Ä–∏–∏ –Ω–∞ —Ç–æ—Ç –¥–µ–Ω—å: `streak_count`

---

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è –æ—Å—Ç–∞–ª–∏—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π. –ù–æ–≤—ã–µ –ø–æ–ª—è –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ, –ø–æ—ç—Ç–æ–º—É —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```javascript
// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
if (statsData.month_xp !== undefined) {
  // –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
  displayMonthXP(statsData.month_xp)
}

if (Array.isArray(statsData.week_xp_by_day)) {
  // –û—Ç–æ–±—Ä–∞–∂–∞–π—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –¥–Ω—è–º
  renderWeeklyChart(statsData.week_xp_by_day)
}

if (Array.isArray(statsData.streak_days)) {
  // –û—Ç–æ–±—Ä–∞–∂–∞–π—Ç–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Å–µ—Ä–∏–π
  renderStreakCalendar(statsData.streak_days)
}
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∫–µ–π—Å–æ–≤

### –ö–µ–π—Å 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –∏–¥–µ–∞–ª—å–Ω–æ–π —Å–µ—Ä–∏–µ–π

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- 5 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ –≤—Å–µ –ø—Ä–∏–≤—ã—á–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- –°–µ–≥–æ–¥–Ω—è 08.12.2025

**–û—Ç–≤–µ—Ç API:**
```json
{
  "streak": 5,
  "streak_days": [
    { "date": "2025-12-08", "is_in_streak": true, "streak_count": 5, "is_scheduled": true },
    { "date": "2025-12-07", "is_in_streak": true, "streak_count": 4, "is_scheduled": true },
    { "date": "2025-12-06", "is_in_streak": true, "streak_count": 3, "is_scheduled": true },
    { "date": "2025-12-05", "is_in_streak": true, "streak_count": 2, "is_scheduled": true },
    { "date": "2025-12-04", "is_in_streak": true, "streak_count": 1, "is_scheduled": true },
    { "date": "2025-12-03", "is_in_streak": false, "streak_count": 0, "is_scheduled": true }
  ]
}
```

**UI:** –í –∫–∞–ª–µ–Ω–¥–∞—Ä–µ –ø–µ—Ä–≤—ã–µ 5 –¥–Ω–µ–π –∑–µ–ª–µ–Ω—ã–µ, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫—Ä–∞—Å–Ω—ã–µ.

---

### –ö–µ–π—Å 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –≤—ã—Ö–æ–¥–Ω—ã–º–∏ –±–µ–∑ –ø—Ä–∏–≤—ã—á–µ–∫

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –ü—Ä–∏–≤—ã—á–∫–∏ —Ç–æ–ª—å–∫–æ –≤ –±—É–¥–Ω–∏
- –°–µ—Ä–∏—è: –ø–Ω, –≤—Ç, —Å—Ä, —á—Ç, –ø—Ç (5 –¥–Ω–µ–π)
- –°—É–±–±–æ—Ç–∞ –∏ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ: `is_scheduled = false`

**–û—Ç–≤–µ—Ç API:**
```json
{
  "streak": 5,
  "streak_days": [
    { "date": "2025-12-08", "is_in_streak": true, "streak_count": 5, "is_scheduled": true },  // –ü–Ω
    { "date": "2025-12-07", "is_in_streak": false, "streak_count": 0, "is_scheduled": false }, // –í—Å
    { "date": "2025-12-06", "is_in_streak": false, "streak_count": 0, "is_scheduled": false }, // –°–±
    { "date": "2025-12-05", "is_in_streak": true, "streak_count": 4, "is_scheduled": true }   // –ü—Ç
  ]
}
```

**UI:** –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –∏ –ø—è—Ç–Ω–∏—Ü–∞ –∑–µ–ª–µ–Ω—ã–µ, —Å—É–±–±–æ—Ç–∞ –∏ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ —Å–µ—Ä—ã–µ (–Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç —Å–µ—Ä–∏—é).

---

### –ö–µ–π—Å 3: –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π XP —Å –∞–º–Ω–∏—Å—Ç–∏–µ–π

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –ü—Ä–∏–≤—ã—á–∫–∞: –Ω–∞–≥—Ä–∞–¥–∞ 10 XP, —à—Ç—Ä–∞—Ñ 20 XP
- –†–µ–∂–∏–º "balanced": `penalty_multiplier = 0.5`
- –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫: –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (+10 XP)
- –í—Ç–æ—Ä–Ω–∏–∫: –ø—Ä–æ–ø—É—â–µ–Ω–æ (-10 XP)
- –°—Ä–µ–¥–∞: –ø—Ä–æ–ø—É—â–µ–Ω–æ, –Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∞–º–Ω–∏—Å—Ç–∏—è (0 XP)

**–û—Ç–≤–µ—Ç API:**
```json
{
  "week_xp_by_day": [
    { "date": "2025-12-02", "xp": 10 },  // –ü–Ω: +10
    { "date": "2025-12-03", "xp": 0 },   // –í—Ç: 10 - 10 = 0 (–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º)
    { "date": "2025-12-04", "xp": 0 }    // –°—Ä: –∞–º–Ω–∏—Å—Ç–∏—è, —à—Ç—Ä–∞—Ñ –Ω–µ –ø—Ä–∏–º–µ–Ω—ë–Ω
  ]
}
```

**UI:** –ì—Ä–∞—Ñ–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–æ–ª–±—Ü—ã –≤—ã—Å–æ—Ç–æ–π 10, 0, 0.

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –†–∞—Å—á–µ—Ç `week_xp_by_day`: –æ–¥–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ –∑–∞ –Ω–µ–¥–µ–ª—é
- –†–∞—Å—á–µ—Ç `streak_days`: –æ–¥–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ –∑–∞ 30 –¥–Ω–µ–π
- –û–±—â–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: –Ω–µ –±–æ–ª–µ–µ 200ms (–¥–æ–±–∞–≤–ª–µ–Ω–æ ~50ms –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏)

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –ø–∞–Ω–µ–ª–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ:
- –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–µ—à–∞: 1 –º–∏–Ω—É—Ç–∞
- –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏–≤—ã—á–µ–∫

```javascript
// –ü—Ä–∏–º–µ—Ä –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
const CACHE_TTL = 60 * 1000 // 1 –º–∏–Ω—É—Ç–∞

let cachedData = null
let cacheTimestamp = null

async function fetchHabitsStatsPanel() {
  const now = Date.now()

  if (cachedData && (now - cacheTimestamp) < CACHE_TTL) {
    return cachedData
  }

  const response = await api.post('/api/rest/front/app/habits/stats-panel/')
  cachedData = response.data.data
  cacheTimestamp = now

  return cachedData
}

// –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
function invalidateStatsCache() {
  cachedData = null
  cacheTimestamp = null
}
```

---

## Changelog

### v2.0 (08.12.2025)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `month_xp` ‚Äî XP –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `week_xp_by_day` ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ XP –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `streak_days` ‚Äî –∏—Å—Ç–æ—Ä–∏—è —Å–µ—Ä–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### v1.0 (–ø—Ä–µ–¥—ã–¥—É—â–∞—è –≤–µ—Ä—Å–∏—è)
- –ë–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: `streak`, `today_completed`, `today_total`, `week_xp`
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏: `amnesty_remaining`, `difficulty_mode`

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
- Backend: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Ç–æ–¥—ã `get_habits_stats_panel()`, `_calculate_xp_by_days()`, `_calculate_streak_days()` –≤ `core/models/globals.py`
- Serializer: `GetHabitsStatsPanelDataSerializer` –≤ `core/serializers/habits.py`

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞: 08.12.2025*