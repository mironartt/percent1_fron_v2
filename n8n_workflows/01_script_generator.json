{
  "name": "Content Factory - Script Generator",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 24,
              "triggerAtHour": 9
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "Daily 09:00",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [0, 0]
    },
    {
      "parameters": {},
      "id": "manual-trigger",
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [0, 200]
    },
    {
      "parameters": {
        "operation": "read",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "YOUR_SPREADSHEET_ID"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": "Sheet1"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "status",
              "lookupValue": "new"
            }
          ]
        },
        "options": {
          "returnAllMatches": {
            "returnAllMatches": true
          }
        }
      },
      "id": "get-new-topics",
      "name": "Get New Topics",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [250, 100],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YOUR_GOOGLE_CREDENTIALS_ID",
          "name": "Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $json.topic }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty"
              }
            }
          ]
        }
      },
      "id": "check-topic-exists",
      "name": "Has Topic?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [450, 100]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.openai.com/v1/chat/completions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "openAiApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"gpt-4o\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –≤–∏—Ä—É—Å–Ω—ã—Ö –∫–æ—Ä–æ—Ç–∫–∏—Ö –≤–∏–¥–µ–æ –¥–ª—è TikTok, Instagram Reels –∏ YouTube Shorts. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - —Å–æ–∑–¥–∞—Ç—å –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–π —Å–∫—Ä–∏–ø—Ç –Ω–∞ 60-90 —Å–µ–∫—É–Ω–¥.\\n\\n–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (JSON):\\n{\\n  \\\"hook\\\": \\\"–¶–µ–ø–ª—è—é—â–µ–µ –Ω–∞—á–∞–ª–æ (–ø–µ—Ä–≤—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã)\\\",\\n  \\\"script\\\": \\\"–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–∫—Ä–∏–ø—Ç–∞\\\",\\n  \\\"key_points\\\": [\\\"–¢–µ–∑–∏—Å 1\\\", \\\"–¢–µ–∑–∏—Å 2\\\", \\\"–¢–µ–∑–∏—Å 3\\\", \\\"–¢–µ–∑–∏—Å 4\\\", \\\"–¢–µ–∑–∏—Å 5\\\"],\\n  \\\"cta\\\": \\\"–ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é –≤ –∫–æ–Ω—Ü–µ\\\"\\n}\\n\\n–ü—Ä–∞–≤–∏–ª–∞:\\n- Hook –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–æ–≤–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–º –∏–ª–∏ –∏–Ω—Ç—Ä–∏–≥—É—é—â–∏–º\\n- –°–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–º, –∫–∞–∫ –±—É–¥—Ç–æ –≥–æ–≤–æ—Ä–∏—à—å —Å –¥—Ä—É–≥–æ–º\\n- 5 –∫–ª—é—á–µ–≤—ã—Ö —Ç–µ–∑–∏—Å–æ–≤ –¥–ª—è –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∏\\n- CTA –¥–æ–ª–∂–µ–Ω –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"–°–æ–∑–¥–∞–π —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Ç–µ–º—É: {{ $json.topic }}\"\n    }\n  ],\n  \"temperature\": 0.8,\n  \"response_format\": { \"type\": \"json_object\" }\n}"
      },
      "id": "generate-script",
      "name": "Generate Script (OpenAI)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [650, 100],
      "credentials": {
        "openAiApi": {
          "id": "YOUR_OPENAI_CREDENTIALS_ID",
          "name": "OpenAI"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const response = JSON.parse($input.first().json.choices[0].message.content);\nconst originalData = $('Get New Topics').first().json;\n\nreturn {\n  id: originalData.id,\n  topic: originalData.topic,\n  hook: response.hook,\n  script: response.script,\n  key_points: JSON.stringify(response.key_points),\n  cta: response.cta,\n  row_number: originalData.row_number\n};"
      },
      "id": "parse-script",
      "name": "Parse Script",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 100]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "YOUR_SPREADSHEET_ID"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": "Sheet1"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $json.id }}",
            "script": "={{ $json.hook }}\\n\\n{{ $json.script }}\\n\\n{{ $json.cta }}",
            "key_points": "={{ $json.key_points }}",
            "status": "script_ready"
          }
        },
        "options": {
          "cellFormat": "USER_ENTERED"
        }
      },
      "id": "update-sheet",
      "name": "Update Sheet",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [1050, 100],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YOUR_GOOGLE_CREDENTIALS_ID",
          "name": "Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "chatId": "YOUR_TELEGRAM_CHAT_ID",
        "text": "=üìù *–ù–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –≥–æ—Ç–æ–≤!*\n\n*–¢–µ–º–∞:* {{ $json.topic }}\n\n*Hook:* {{ $json.hook }}\n\n*–°–∫—Ä–∏–ø—Ç:*\n{{ $json.script }}\n\n*–¢–µ–∑–∏—Å—ã –¥–ª—è –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∏:*\n{{ $json.key_points }}\n\n*CTA:* {{ $json.cta }}",
        "additionalFields": {
          "parse_mode": "Markdown",
          "reply_markup": {
            "inline_keyboard": [
              [
                {
                  "text": "‚úÖ –û–¥–æ–±—Ä–∏—Ç—å —Å–∫—Ä–∏–ø—Ç",
                  "callback_data": "approve_script_{{ $json.id }}"
                },
                {
                  "text": "‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å",
                  "callback_data": "reject_script_{{ $json.id }}"
                }
              ],
              [
                {
                  "text": "‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å —Ç–µ–º—É",
                  "callback_data": "edit_topic_{{ $json.id }}"
                }
              ]
            ]
          }
        }
      },
      "id": "send-to-telegram",
      "name": "Send to Telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [1250, 100],
      "credentials": {
        "telegramApi": {
          "id": "YOUR_TELEGRAM_CREDENTIALS_ID",
          "name": "Telegram Bot"
        }
      }
    }
  ],
  "connections": {
    "Daily 09:00": {
      "main": [
        [
          {
            "node": "Get New Topics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Manual Trigger": {
      "main": [
        [
          {
            "node": "Get New Topics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get New Topics": {
      "main": [
        [
          {
            "node": "Has Topic?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has Topic?": {
      "main": [
        [
          {
            "node": "Generate Script (OpenAI)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Script (OpenAI)": {
      "main": [
        [
          {
            "node": "Parse Script",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Script": {
      "main": [
        [
          {
            "node": "Update Sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Sheet": {
      "main": [
        [
          {
            "node": "Send to Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  }
}
