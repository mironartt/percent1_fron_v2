{% extends "catalog/base.html" %}
{% load static %}

{% block title %}{{ subcategory.name }} ‚Äî {{ subcategory.goals_count }} –ø–æ—à–∞–≥–æ–≤—ã—Ö –ø–ª–∞–Ω–æ–≤ ‚Ä¢ OnePercent{% endblock %}
{% block description %}{{ subcategory.goals_count }} —Ü–µ–ª–µ–π –≤ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ {{ subcategory.name }}: {{ subcategory.short_description }}{% endblock %}
{% block og_title %}{{ subcategory.name }} ‚Äî {{ subcategory.goals_count }} —Ü–µ–ª–µ–π ‚Ä¢ OnePercent{% endblock %}
{% block og_description %}{{ subcategory.goals_count }} —Ü–µ–ª–µ–π: {{ subcategory.short_description }}{% endblock %}
{% block og_url %}https://percent1.ru/catalog/goals/{{ category.slug }}/{{ subcategory.slug }}/{% endblock %}

{% block breadcrumbs %}
<a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
<span class="separator">‚Ä∫</span>
<a href="/catalog/">–ö–∞—Ç–∞–ª–æ–≥</a>
<span class="separator">‚Ä∫</span>
<a href="/catalog/goals/">–¶–µ–ª–∏</a>
<span class="separator">‚Ä∫</span>
<a href="/catalog/goals/{{ category.slug }}/">{{ category.name }}</a>
<span class="separator">‚Ä∫</span>
<span class="current">{{ subcategory.name }}</span>
{% endblock %}

{% block content %}
<section class="hero-section">
    <div class="hero-icon">{{ subcategory.icon }}</div>
    <h1 class="hero-title">{{ subcategory.name }}</h1>
    <p class="hero-subtitle">{{ subcategory.goals_count }} —Ü–µ–ª–µ–π {{ subcategory.description_genitive }}.<br>{{ subcategory.tagline }}</p>
    <p class="hero-category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è: <a href="/catalog/goals/{{ category.slug }}/">{{ category.icon }} {{ category.name }}</a></p>
</section>

<section class="filters-section">
    <h2 class="section-title">–§–∏–ª—å—Ç—Ä—ã</h2>
    <div class="filters-grid">
        <div class="filter-group">
            <span class="filter-label">–°–ª–æ–∂–Ω–æ—Å—Ç—å:</span>
            <div class="filter-buttons">
                <a href="?difficulty=" class="filter-btn {% if not current_difficulty %}active{% endif %}">–í—Å–µ</a>
                <a href="?difficulty=easy" class="filter-btn {% if current_difficulty == 'easy' %}active{% endif %}">‚≠ê –õ—ë–≥–∫–∏–µ</a>
                <a href="?difficulty=medium" class="filter-btn {% if current_difficulty == 'medium' %}active{% endif %}">‚≠ê‚≠ê –°—Ä–µ–¥–Ω–∏–µ</a>
                <a href="?difficulty=hard" class="filter-btn {% if current_difficulty == 'hard' %}active{% endif %}">‚≠ê‚≠ê‚≠ê –°–ª–æ–∂–Ω—ã–µ</a>
            </div>
        </div>
        <div class="filter-group">
            <span class="filter-label">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</span>
            <div class="filter-buttons">
                <a href="?duration=" class="filter-btn {% if not current_duration %}active{% endif %}">–í—Å–µ</a>
                <a href="?duration=1m" class="filter-btn {% if current_duration == '1m' %}active{% endif %}">–î–æ 1 –º–µ—Å</a>
                <a href="?duration=1-3m" class="filter-btn {% if current_duration == '1-3m' %}active{% endif %}">1-3 –º–µ—Å</a>
                <a href="?duration=3-6m" class="filter-btn {% if current_duration == '3-6m' %}active{% endif %}">3-6 –º–µ—Å</a>
                <a href="?duration=6m+" class="filter-btn {% if current_duration == '6m+' %}active{% endif %}">6+ –º–µ—Å</a>
            </div>
        </div>
        <div class="filter-group">
            <span class="filter-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</span>
            <div class="filter-buttons">
                <a href="?sort=popular" class="filter-btn {% if current_sort == 'popular' or not current_sort %}active{% endif %}">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</a>
                <a href="?sort=new" class="filter-btn {% if current_sort == 'new' %}active{% endif %}">–ù–æ–≤—ã–µ</a>
            </div>
        </div>
    </div>
</section>

<section class="goals-section">
    <h2 class="section-title">–¶–µ–ª–∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ({{ subcategory.goals_count }})</h2>
    <div class="goals-list">
        {% for goal in goals %}
        <article class="goal-card-full detailed">
            <div class="goal-header">
                <span class="goal-icon">üéØ</span>
                <div class="goal-content">
                    <h3><a href="/catalog/goals/{{ category.slug }}/{{ subcategory.slug }}/{{ goal.slug }}/">{{ goal.name }}</a></h3>
                    <div class="goal-meta">
                        <span>{{ goal.steps_count }} —à–∞–≥–æ–≤</span>
                        <span class="difficulty-{{ goal.difficulty }}">{{ goal.difficulty_display }}</span>
                        <span>{{ goal.duration_display }}</span>
                    </div>
                </div>
                {% if goal.is_popular %}
                <span class="popular-badge">‚≠ê –ü–æ–ø—É–ª—è—Ä–Ω–∞—è</span>
                {% endif %}
            </div>
            <p class="goal-description">{{ goal.description }}</p>
            
            {% if goal.steps_preview %}
            <div class="goal-steps-preview">
                <span class="steps-label">–®–∞–≥–∏:</span>
                {% for step in goal.steps_preview %}
                <span class="step-preview">{{ step.name }}</span>
                {% if not forloop.last %}‚Üí{% endif %}
                {% endfor %}
                {% if goal.steps_count > 3 %}...{% endif %}
            </div>
            {% endif %}
            
            <div class="goal-tags">
                {% for tag in goal.tags.all|slice:":5" %}
                <a href="/catalog/goals/tags/{{ tag.slug }}/" class="goal-tag">#{{ tag.name }}</a>
                {% endfor %}
            </div>
            
            {% if goal.related_habits %}
            <div class="goal-related-habits">
                <span class="related-label">–°–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏:</span>
                {% for habit in goal.related_habits|slice:":2" %}
                <a href="/catalog/habits/{{ habit.category.slug }}/{{ habit.subcategory.slug }}/{{ habit.slug }}/">{{ habit.name }}</a>{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </div>
            {% endif %}
            
            <div class="goal-actions">
                <a href="/catalog/goals/{{ category.slug }}/{{ subcategory.slug }}/{{ goal.slug }}/" class="btn-link">–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Ü–µ–ª–∏ ‚Üí</a>
                <a href="/auth/register/?add_goal={{ goal.id }}" class="btn btn-outline">+ –î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å</a>
            </div>
        </article>
        {% endfor %}
    </div>
</section>

<section class="related-habits-section">
    <h2 class="section-title">–ü—Ä–∏–≤—ã—á–∫–∏ –¥–ª—è {{ subcategory.name_genitive }}</h2>
    <p class="section-desc">–≠—Ç–∏ –ø—Ä–∏–≤—ã—á–∫–∏ –ø–æ–º–æ–≥—É—Ç –¥–æ—Å—Ç–∏—á—å —Ü–µ–ª–µ–π –ø–æ {{ subcategory.name_dative }}:</p>
    <div class="habits-grid compact">
        {% for habit in related_habits %}
        <a href="/catalog/habits/{{ habit.category.slug }}/{{ habit.subcategory.slug }}/{{ habit.slug }}/" class="habit-card-mini">
            <div class="habit-header">
                <span class="habit-icon">‚ö°</span>
                <h3>{{ habit.name }}</h3>
            </div>
            <div class="habit-meta">
                <span>{{ habit.duration_display }}</span>
                <span class="difficulty-{{ habit.difficulty }}">{{ habit.difficulty_display }}</span>
            </div>
            <span class="card-link">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</span>
        </a>
        {% endfor %}
    </div>
</section>

{% if articles %}
<section class="articles-section">
    <h2 class="section-title">–°—Ç–∞—Ç—å–∏ –∏ —Å–æ–≤–µ—Ç—ã</h2>
    <div class="articles-list">
        {% for article in articles %}
        <a href="{{ article.url }}" class="article-link">üìñ {{ article.title }}</a>
        {% endfor %}
    </div>
</section>
{% endif %}

<section class="other-subcategories-section">
    <h2 class="section-title">–î—Ä—É–≥–∏–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ {{ category.name_prepositional }}</h2>
    <div class="subcategories-links">
        {% for subcat in other_subcategories %}
        <a href="/catalog/goals/{{ category.slug }}/{{ subcat.slug }}/" class="subcategory-link-btn">{{ subcat.icon }} {{ subcat.name }} ({{ subcat.goals_count }})</a>
        {% endfor %}
    </div>
</section>

<section class="other-categories-section">
    <h2 class="section-title">–î—Ä—É–≥–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
    <div class="categories-links">
        {% for cat in other_categories %}
        <a href="/catalog/goals/{{ cat.slug }}/" class="category-link-btn">{{ cat.icon }} {{ cat.name }}</a>
        {% endfor %}
    </div>
</section>
{% endblock %}
