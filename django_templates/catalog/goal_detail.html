{% extends "catalog/base.html" %}
{% load static %}

{% block title %}{{ goal.name }} ‚Äî –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è ‚Ä¢ OnePercent{% endblock %}
{% block description %}{{ goal.name }}: {{ goal.short_description }}. {{ goal.steps_count }} —à–∞–≥–æ–≤, {{ goal.difficulty_display }}, {{ goal.duration_display }}.{% endblock %}
{% block og_title %}{{ goal.name }} ‚Äî –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω ‚Ä¢ OnePercent{% endblock %}
{% block og_description %}{{ goal.short_description }}. {{ goal.steps_count }} —à–∞–≥–æ–≤ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.{% endblock %}
{% block og_url %}https://percent1.ru/catalog/goals/{{ category.slug }}/{{ subcategory.slug }}/{{ goal.slug }}/{% endblock %}

{% block breadcrumbs %}
<a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
<span class="separator">‚Ä∫</span>
<a href="/catalog/">–ö–∞—Ç–∞–ª–æ–≥</a>
<span class="separator">‚Ä∫</span>
<a href="/catalog/goals/">–¶–µ–ª–∏</a>
<span class="separator">‚Ä∫</span>
<a href="/catalog/goals/{{ category.slug }}/">{{ category.name }}</a>
<span class="separator">‚Ä∫</span>
<a href="/catalog/goals/{{ category.slug }}/{{ subcategory.slug }}/">{{ subcategory.name }}</a>
<span class="separator">‚Ä∫</span>
<span class="current">{{ goal.name_short }}</span>
{% endblock %}

{% block content %}
<article class="goal-detail-page">
    <section class="hero-section goal-hero">
        <div class="hero-icon">üéØ</div>
        <h1 class="hero-title">{{ goal.name }}</h1>
        <p class="goal-category-path">
            <a href="/catalog/goals/{{ category.slug }}/">{{ category.icon }} {{ category.name }}</a>
            <span class="path-separator">‚Ä∫</span>
            <a href="/catalog/goals/{{ category.slug }}/{{ subcategory.slug }}/">{{ subcategory.icon }} {{ subcategory.name }}</a>
        </p>
        <div class="goal-stats">
            <div class="stat-item">
                <span class="stat-value">{{ goal.steps_count }}</span>
                <span class="stat-label">—à–∞–≥–æ–≤</span>
            </div>
            <div class="stat-item">
                <span class="stat-value difficulty-{{ goal.difficulty }}">{{ goal.difficulty_display }}</span>
                <span class="stat-label">—Å–ª–æ–∂–Ω–æ—Å—Ç—å</span>
            </div>
            <div class="stat-item">
                <span class="stat-value">{{ goal.duration_display }}</span>
                <span class="stat-label">–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</span>
            </div>
        </div>
        <div class="goal-cta">
            <a href="/auth/register/?add_goal={{ goal.id }}" class="btn btn-primary btn-lg">+ –î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å –≤ —Å–≤–æ–π –ø–ª–∞–Ω</a>
        </div>
    </section>

    <section class="goal-description-section">
        <h2 class="section-title">–û–ø–∏—Å–∞–Ω–∏–µ</h2>
        <div class="goal-full-description">
            {{ goal.description|linebreaks }}
        </div>
    </section>

    {% if goal.benefits %}
    <section class="goal-benefits-section">
        <h2 class="section-title">–ß—Ç–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ</h2>
        <ul class="benefits-list">
            {% for benefit in goal.benefits %}
            <li>‚úì {{ benefit }}</li>
            {% endfor %}
        </ul>
    </section>
    {% endif %}

    <section class="goal-steps-section">
        <h2 class="section-title">–®–∞–≥–∏ –∫ —Ü–µ–ª–∏ ({{ goal.steps_count }})</h2>
        <div class="steps-list">
            {% for step in steps %}
            <div class="step-card">
                <div class="step-number">{{ forloop.counter }}</div>
                <div class="step-content">
                    <h3>
                        <a href="/catalog/goals/steps/{{ step.slug }}/">{{ step.name }}</a>
                    </h3>
                    <p>{{ step.short_description }}</p>
                    <div class="step-meta">
                        <span>‚è± {{ step.duration_display }}</span>
                        <span class="difficulty-{{ step.difficulty }}">{{ step.difficulty_display }}</span>
                    </div>
                </div>
                <a href="/catalog/goals/steps/{{ step.slug }}/" class="step-link">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí</a>
            </div>
            {% endfor %}
        </div>
    </section>

    <section class="goal-tags-section">
        <h2 class="section-title">–¢–µ–≥–∏</h2>
        <div class="tags-cloud">
            {% for tag in goal.tags.all %}
            <a href="/catalog/goals/tags/{{ tag.slug }}/" class="tag-link">#{{ tag.name }}</a>
            {% endfor %}
        </div>
    </section>

    {% if related_habits %}
    <section class="related-habits-section">
        <h2 class="section-title">–°–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏</h2>
        <p class="section-desc">–≠—Ç–∏ –ø—Ä–∏–≤—ã—á–∫–∏ –ø–æ–º–æ–≥—É—Ç –¥–æ—Å—Ç–∏—á—å —Ü–µ–ª–∏ –±—ã—Å—Ç—Ä–µ–µ:</p>
        <div class="habits-grid compact">
            {% for habit in related_habits %}
            <a href="/catalog/habits/{{ habit.category.slug }}/{{ habit.subcategory.slug }}/{{ habit.slug }}/" class="habit-card-mini">
                <div class="habit-header">
                    <span class="habit-icon">‚ö°</span>
                    <h3>{{ habit.name }}</h3>
                </div>
                <div class="habit-meta">
                    <span>{{ habit.category.icon }} {{ habit.duration_display }}</span>
                    <span class="difficulty-{{ habit.difficulty }}">{{ habit.difficulty_display }}</span>
                </div>
            </a>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    {% if related_bundle %}
    <section class="bundle-promo-section">
        <div class="bundle-promo-card">
            <div class="bundle-promo-icon">üì¶</div>
            <div class="bundle-promo-content">
                <h3>–ì–æ—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä: {{ related_bundle.name }}</h3>
                <p>–≠—Ç–∞ —Ü–µ–ª—å + {{ related_bundle.habits_count }} –ø—Ä–∏–≤—ã—á–µ–∫ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</p>
            </div>
            <a href="/catalog/bundles/{{ related_bundle.slug }}/" class="btn btn-primary green">–°–º–æ—Ç—Ä–µ—Ç—å –Ω–∞–±–æ—Ä ‚Üí</a>
        </div>
    </section>
    {% endif %}

    {% if similar_goals %}
    <section class="similar-goals-section">
        <h2 class="section-title">–ü–æ—Ö–æ–∂–∏–µ —Ü–µ–ª–∏</h2>
        <div class="goals-list compact">
            {% for similar in similar_goals %}
            <a href="/catalog/goals/{{ similar.category.slug }}/{{ similar.subcategory.slug }}/{{ similar.slug }}/" class="goal-card-compact">
                <span class="goal-icon">üéØ</span>
                <div class="goal-info">
                    <h3>{{ similar.name }}</h3>
                    <p class="goal-meta-compact">{{ similar.steps_count }} —à–∞–≥–æ–≤ ‚Ä¢ {{ similar.difficulty_display }}</p>
                </div>
            </a>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <section class="cta-section">
        <div class="cta-box">
            <h2>–ù–∞—á–Ω–∏—Ç–µ –ø—É—Ç—å –∫ —Ü–µ–ª–∏ —Å–µ–≥–æ–¥–Ω—è</h2>
            <p>–î–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Ü–µ–ª—å –≤ —Å–≤–æ–π –ø–ª–∞–Ω –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å</p>
            <a href="/auth/register/?add_goal={{ goal.id }}" class="btn btn-primary btn-lg">–ù–∞—á–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ</a>
        </div>
    </section>

    <section class="other-categories-section">
        <h2 class="section-title">–î—Ä—É–≥–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
        <div class="categories-links">
            {% for cat in other_categories %}
            <a href="/catalog/goals/{{ cat.slug }}/" class="category-link-btn">{{ cat.icon }} {{ cat.name }}</a>
            {% endfor %}
        </div>
    </section>
</article>
{% endblock %}
