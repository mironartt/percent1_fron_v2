{% extends "catalog/base.html" %}
{% load static %}

{% block title %}{{ category.name }} ‚Äî {{ category.habits_count }} –ø—Ä–∏–≤—ã—á–µ–∫ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è ‚Ä¢ OnePercent{% endblock %}
{% block description %}{{ category.habits_count }} –ø—Ä–∏–≤—ã—á–µ–∫ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ {{ category.name }}: {{ category.short_description }}. –ü–æ—à–∞–≥–æ–≤—ã–µ –ø–ª–∞–Ω—ã —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è.{% endblock %}
{% block og_title %}{{ category.name }} ‚Äî {{ category.habits_count }} –ø—Ä–∏–≤—ã—á–µ–∫ ‚Ä¢ OnePercent{% endblock %}
{% block og_description %}{{ category.habits_count }} –ø—Ä–∏–≤—ã—á–µ–∫ –¥–ª—è {{ category.description_genitive }}.{% endblock %}
{% block og_url %}https://percent1.ru/catalog/habits/{{ category.slug }}/{% endblock %}

{% block breadcrumbs %}
<a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
<span class="separator">‚Ä∫</span>
<a href="/catalog/">–ö–∞—Ç–∞–ª–æ–≥</a>
<span class="separator">‚Ä∫</span>
<a href="/catalog/habits/">–ü—Ä–∏–≤—ã—á–∫–∏</a>
<span class="separator">‚Ä∫</span>
<span class="current">{{ category.name }}</span>
{% endblock %}

{% block content %}
<section class="hero-section yellow">
    <div class="hero-icon">{{ category.icon }}</div>
    <h1 class="hero-title">{{ category.name }}</h1>
    <p class="hero-subtitle">{{ category.habits_count }} –ø—Ä–∏–≤—ã—á–µ–∫ –¥–ª—è {{ category.description_genitive }}.<br>{{ category.tagline }}</p>
    <form class="search-box" action="/catalog/habits/{{ category.slug }}/search/" method="GET">
        <input type="text" name="q" class="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏...">
        <button type="submit" class="search-btn orange">üîé</button>
    </form>
</section>

<section class="subcategories-section">
    <h2 class="section-title">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
    <div class="subcategories-grid">
        {% for subcategory in subcategories %}
        <a href="/catalog/habits/{{ category.slug }}/{{ subcategory.slug }}/" class="subcategory-card orange">
            <div class="subcategory-icon">{{ subcategory.icon }}</div>
            <h3>{{ subcategory.name }}</h3>
            <p class="subcategory-count">{{ subcategory.habits_count }} –ø—Ä–∏–≤—ã—á–µ–∫</p>
            <p class="subcategory-desc">{{ subcategory.short_description }}</p>
            <span class="card-link orange">–°–º–æ—Ç—Ä–µ—Ç—å ‚Üí</span>
        </a>
        {% endfor %}
    </div>
</section>

<section class="filters-section">
    <h2 class="section-title">–§–∏–ª—å—Ç—Ä—ã</h2>
    <div class="filters-grid">
        <div class="filter-group">
            <span class="filter-label">–°–ª–æ–∂–Ω–æ—Å—Ç—å:</span>
            <div class="filter-buttons">
                <a href="?difficulty=" class="filter-btn {% if not current_difficulty %}active{% endif %}">–í—Å–µ</a>
                <a href="?difficulty=easy" class="filter-btn {% if current_difficulty == 'easy' %}active{% endif %}">‚≠ê –õ—ë–≥–∫–∏–µ</a>
                <a href="?difficulty=medium" class="filter-btn {% if current_difficulty == 'medium' %}active{% endif %}">‚≠ê‚≠ê –°—Ä–µ–¥–Ω–∏–µ</a>
                <a href="?difficulty=hard" class="filter-btn {% if current_difficulty == 'hard' %}active{% endif %}">‚≠ê‚≠ê‚≠ê –°–ª–æ–∂–Ω—ã–µ</a>
            </div>
        </div>
        <div class="filter-group">
            <span class="filter-label">–í—Ä–µ–º—è:</span>
            <div class="filter-buttons">
                <a href="?duration=" class="filter-btn {% if not current_duration %}active{% endif %}">–í—Å–µ</a>
                <a href="?duration=5m" class="filter-btn {% if current_duration == '5m' %}active{% endif %}">–î–æ 5 –º–∏–Ω</a>
                <a href="?duration=5-15m" class="filter-btn {% if current_duration == '5-15m' %}active{% endif %}">5-15 –º–∏–Ω</a>
                <a href="?duration=15-30m" class="filter-btn {% if current_duration == '15-30m' %}active{% endif %}">15-30 –º–∏–Ω</a>
                <a href="?duration=30m+" class="filter-btn {% if current_duration == '30m+' %}active{% endif %}">30+ –º–∏–Ω</a>
            </div>
        </div>
        <div class="filter-group">
            <span class="filter-label">–ß–∞—Å—Ç–æ—Ç–∞:</span>
            <div class="filter-buttons">
                <a href="?frequency=" class="filter-btn {% if not current_frequency %}active{% endif %}">–í—Å–µ</a>
                <a href="?frequency=daily" class="filter-btn {% if current_frequency == 'daily' %}active{% endif %}">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</a>
                <a href="?frequency=weekdays" class="filter-btn {% if current_frequency == 'weekdays' %}active{% endif %}">–ü–æ –±—É–¥–Ω—è–º</a>
                <a href="?frequency=3-4" class="filter-btn {% if current_frequency == '3-4' %}active{% endif %}">3-4 —Ä–∞–∑–∞/–Ω–µ–¥</a>
                <a href="?frequency=weekly" class="filter-btn {% if current_frequency == 'weekly' %}active{% endif %}">–†–∞–∑ –≤ –Ω–µ–¥–µ–ª—é</a>
            </div>
        </div>
        <div class="filter-group">
            <span class="filter-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</span>
            <div class="filter-buttons">
                <a href="?sort=popular" class="filter-btn {% if current_sort == 'popular' or not current_sort %}active{% endif %}">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</a>
                <a href="?sort=new" class="filter-btn {% if current_sort == 'new' %}active{% endif %}">–ù–æ–≤—ã–µ</a>
                <a href="?sort=difficulty" class="filter-btn {% if current_sort == 'difficulty' %}active{% endif %}">–ü–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</a>
                <a href="?sort=duration" class="filter-btn {% if current_sort == 'duration' %}active{% endif %}">–ü–æ –≤—Ä–µ–º–µ–Ω–∏</a>
            </div>
        </div>
    </div>
</section>

<section class="habits-section">
    <h2 class="section-title">–í—Å–µ –ø—Ä–∏–≤—ã—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ({{ category.habits_count }})</h2>
    <div class="habits-list">
        {% for habit in habits %}
        <article class="habit-card-full">
            <div class="habit-header">
                <span class="habit-icon">‚ö°</span>
                <div class="habit-content">
                    <h3><a href="/catalog/habits/{{ category.slug }}/{{ habit.subcategory.slug }}/{{ habit.slug }}/">{{ habit.name }}</a></h3>
                    <div class="habit-meta">
                        <span class="habit-subcategory orange">{{ habit.subcategory.icon }} {{ habit.subcategory.name }}</span>
                        <span>‚è± {{ habit.duration_display }}</span>
                        <span class="difficulty-{{ habit.difficulty }}">{{ habit.difficulty_display }}</span>
                        <span>üìÖ {{ habit.frequency_display }}</span>
                    </div>
                </div>
                {% if habit.is_popular %}
                <span class="popular-badge orange">‚≠ê –ü–æ–ø—É–ª—è—Ä–Ω–∞—è</span>
                {% endif %}
            </div>
            <p class="habit-description">{{ habit.short_description }}</p>
            <div class="habit-tags">
                {% for tag in habit.tags.all|slice:":4" %}
                <a href="/catalog/habits/tags/{{ tag.slug }}/" class="habit-tag">#{{ tag.name }}</a>
                {% endfor %}
            </div>
            <div class="habit-actions">
                <a href="/catalog/habits/{{ category.slug }}/{{ habit.subcategory.slug }}/{{ habit.slug }}/" class="btn-link orange">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí</a>
                <a href="/auth/register/?add_habit={{ habit.id }}" class="btn btn-outline orange">+ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É</a>
            </div>
        </article>
        {% endfor %}
    </div>

    {% if habits.has_other_pages %}
    <nav class="pagination">
        {% if habits.has_previous %}
        <a href="?page={{ habits.previous_page_number }}" class="page-link">‚óÄ –ù–∞–∑–∞–¥</a>
        {% endif %}
        {% for num in habits.paginator.page_range %}
            {% if habits.number == num %}
            <span class="page-current">{{ num }}</span>
            {% else %}
            <a href="?page={{ num }}" class="page-link">{{ num }}</a>
            {% endif %}
        {% endfor %}
        {% if habits.has_next %}
        <a href="?page={{ habits.next_page_number }}" class="page-link">–í–ø–µ—Ä—ë–¥ ‚ñ∂</a>
        {% endif %}
    </nav>
    {% endif %}
</section>

<section class="tags-section">
    <h2 class="section-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–≥–∏ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
    <div class="tags-cloud">
        {% for tag in popular_tags %}
        <a href="/catalog/habits/tags/{{ tag.slug }}/" class="tag-link orange">#{{ tag.name }}</a>
        {% endfor %}
    </div>
</section>

<section class="related-goals-section">
    <h2 class="section-title">–¶–µ–ª–∏ –¥–ª—è {{ category.name_genitive }}</h2>
    <p class="section-desc">–°—Ç–∞–≤—å—Ç–µ —Ü–µ–ª–∏ –∏ —Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ –ø—Ä–∏–≤—ã—á–∫–∏ –≤–º–µ—Å—Ç–µ:</p>
    <div class="goals-list compact">
        {% for goal in related_goals %}
        <a href="/catalog/goals/{{ goal.category.slug }}/{{ goal.subcategory.slug }}/{{ goal.slug }}/" class="goal-card-compact">
            <span class="goal-icon">üéØ</span>
            <div class="goal-info">
                <h3>{{ goal.name }}</h3>
                <p class="goal-meta-compact">{{ goal.steps_count }} —à–∞–≥–æ–≤ ‚Ä¢ {{ goal.difficulty_display }}</p>
            </div>
        </a>
        {% endfor %}
    </div>
    <a href="/catalog/goals/{{ category.slug }}/" class="section-link">–í—Å–µ —Ü–µ–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Üí</a>
</section>

<section class="other-categories-section">
    <h2 class="section-title">–î—Ä—É–≥–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏–≤—ã—á–µ–∫</h2>
    <div class="categories-links">
        {% for cat in other_categories %}
        <a href="/catalog/habits/{{ cat.slug }}/" class="category-link-btn orange">{{ cat.icon }} {{ cat.name }}</a>
        {% endfor %}
    </div>
</section>
{% endblock %}
