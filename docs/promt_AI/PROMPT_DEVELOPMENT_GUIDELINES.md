# ГАЙДЛАЙНЫ РАЗРАБОТКИ ПРОМПТОВ

> **Цель:** Набор правил и рекомендаций для создания качественных промптов с минимумом ошибок.

---

## 1. СТРУКТУРА ФАЙЛОВ ПРОМПТОВ

### 1.1 Стандартная структура папки для нового промпта

```
docs/promt_AI/
└── {prompt_name}/
    ├── {prompt_name}_system_prompt.md    # Системный промпт (роль, контекст)
    ├── {prompt_name}_user_prompt_template.md  # User prompt с переменными
    ├── {prompt_name}_examples.md         # Примеры ввода/вывода
    ├── {prompt_name}_UPDATED_FORMAT.md   # Актуальная версия (если есть)
    └── README.md                         # Документация и changelog
```

### 1.2 Именование файлов

- **snake_case** для всех файлов
- Суффиксы: `_system_prompt`, `_user_prompt_template`, `_examples`
- Для обновлённых версий: `_UPDATED_FORMAT` или `_v2`

---

## 2. ПРОЦЕСС СОЗДАНИЯ НОВОГО ПРОМПТА

### 2.1 Чеклист перед началом

- [ ] Определена цель промпта
- [ ] Определён контекст использования (уведомление/чат/скоринг)
- [ ] Изучен `PROMPT_VARIABLES_REFERENCE.md`
- [ ] Изучены существующие промпты как референс

### 2.2 Шаги создания

1. **Создать папку** с именем промпта
2. **Написать system prompt:**
   - Роль AI
   - Ограничения
   - Стиль общения
3. **Написать user prompt template:**
   - Все переменные из справочника
   - Handlebars условия для опциональных полей
   - Задача для AI
4. **Создать examples:**
   - Минимум 3 примера разных сценариев
   - Включая edge cases
5. **Написать README:**
   - Назначение
   - Список переменных
   - Примечания

---

## 3. ПРАВИЛА РАБОТЫ С ПЕРЕМЕННЫМИ

### 3.1 Обязательно

- **Сверять имена** с `PROMPT_VARIABLES_REFERENCE.md`
- **Добавлять новые переменные** в справочник
- **Использовать условия** `{{#if}}` для опциональных полей
- **Проверять типы:** string vs number vs boolean vs array

### 3.2 Типичные ошибки

| Ошибка | Правильно |
|--------|-----------|
| `{{userName}}` | `{{user_name}}` |
| `{{user.name}}` | `{{user_name}}` |
| `{{tasks.completed}}` | `{{tasks_completed}}` |
| `{{#each habit}}` | `{{#each habits}}` |
| `{{habit.title}}` внутри each | `{{this.title}}` |

### 3.3 Добавление новой переменной

1. Проверить, нет ли похожей в справочнике
2. Добавить в соответствующий раздел справочника
3. Указать тип, описание, где используется
4. Если переменная для будущего — добавить в раздел 14

---

## 4. ТЕСТИРОВАНИЕ ПРОМПТОВ

### 4.1 Ручное тестирование

Для каждого промпта проверить с данными:

1. **Полные данные** — все поля заполнены
2. **Минимальные данные** — только обязательные поля
3. **Пустые массивы** — `habits: []`, `goals_progress: []`
4. **Null значения** — `near_reward: null`
5. **Граничные значения** — 0%, 100%, 0 дней, 365 дней

### 4.2 Автоматическая валидация (рекомендация)

```javascript
// Пример схемы валидации для morning notification
const morningNotificationSchema = {
  required: ['user_name', 'current_date', 'day_of_week'],
  properties: {
    user_name: { type: 'string' },
    current_date: { type: 'string', pattern: /^\d{2}\.\d{2}\.\d{4}$/ },
    today_plan: {
      type: 'object',
      properties: {
        planned_steps: { type: 'number', min: 0 },
        steps_list: { type: 'array' }
      }
    }
  }
}
```

---

## 5. ВЕРСИОНИРОВАНИЕ

### 5.1 Когда создавать новую версию

- Изменение структуры переменных
- Существенное изменение логики
- Изменение формата вывода

### 5.2 Как версионировать

1. **Мелкие правки:** редактировать файл напрямую, добавить в changelog
2. **Средние изменения:** создать `_UPDATED_FORMAT.md`
3. **Крупные изменения:** создать `_v2` папку

### 5.3 Changelog

В README.md каждого промпта:

```markdown
## Changelog

### v1.2 (2025-01-20)
- Добавлена переменная `streak_at_risk`
- Исправлена обработка пустых привычек

### v1.1 (2025-01-15)
- Изменена длина ответа с 2-4 на 2-6 предложений
```

---

## 6. СТАНДАРТЫ КАЧЕСТВА

### 6.1 System Prompt

- [ ] Чётко определена роль AI
- [ ] Указаны ограничения (что НЕ делать)
- [ ] Описан стиль общения
- [ ] Нет противоречий в инструкциях

### 6.2 User Prompt Template

- [ ] Все переменные из справочника
- [ ] Условия для опциональных полей
- [ ] Чёткая задача для AI
- [ ] Примеры форматирования вывода
- [ ] Указаны требования к длине ответа

### 6.3 Examples

- [ ] Минимум 3 примера
- [ ] Покрывают разные сценарии
- [ ] Включают edge cases
- [ ] Соответствуют требованиям промпта

---

## 7. БЕЗОПАСНОСТЬ И ЭТИКА

### 7.1 Обязательные проверки

- **Crisis detection:** все промпты чата должны учитывать кризисные состояния
- **No medical advice:** не давать медицинских советов
- **No financial advice:** не давать инвестиционных советов
- **Respectful tone:** уважительный тон без давления

### 7.2 Шаблоны безопасности

Использовать стандартные сообщения из `message_scoring_system.md`:

- Crisis message
- Medical redirect
- Psychological redirect
- Off-topic redirect

---

## 8. ИНТЕГРАЦИЯ С БЭКЕНДОМ

### 8.1 Формат данных

- Бэкенд отправляет данные в JSON
- Фронтенд конвертирует в Handlebars context
- Все даты в формате "DD.MM.YYYY"
- Все времена в формате "HH:MM"

### 8.2 Обработка ошибок

Промпт должен работать даже при:
- Отсутствии опциональных данных
- Пустых массивах
- Null значениях

---

## 9. РЕКОМЕНДАЦИИ ПО ЭФФЕКТИВНОСТИ

### 9.1 При создании нового промпта

1. Скопировать структуру существующего промпта как шаблон
2. Использовать переменные из справочника
3. Не изобретать новые имена для существующих данных
4. Тестировать с реальными данными

### 9.2 При модификации существующего

1. Прочитать весь промпт перед изменением
2. Проверить, не сломается ли логика
3. Обновить examples если изменился формат
4. Добавить запись в changelog

### 9.3 Code Review чеклист

- [ ] Переменные соответствуют справочнику
- [ ] Handlebars синтаксис корректен
- [ ] Есть обработка пустых/null значений
- [ ] Examples актуальны
- [ ] Changelog обновлён

---

## 10. ПОЛЕЗНЫЕ ССЫЛКИ

- [PROMPT_VARIABLES_REFERENCE.md](./PROMPT_VARIABLES_REFERENCE.md) — справочник переменных
- [MENTOR_DEVELOPMENT_PLAN.md](./MENTOR_DEVELOPMENT_PLAN.md) — план развития ментора
- [MENTOR_DEEP_RESEARCH_v2.md](./MENTOR_DEEP_RESEARCH_v2.md) — исследование лучших практик
- [chat_bot_response_system.md](./chat_bot_response_system.md) — главный промпт чат-бота
- [message_scoring_system.md](./message_scoring_system.md) — фильтрация сообщений

---

## ИСТОРИЯ ИЗМЕНЕНИЙ

| Дата | Изменение |
|------|-----------|
| 2025-01-20 | Создан документ |

