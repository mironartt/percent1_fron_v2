# Изменения: Адаптивная длина уведомлений (2-6 предложений)

## Что изменилось

### Было (v1.0):
- Фиксированная длина: **2-3 предложения**
- Один подход для всех ситуаций
- Сложные паттерны требовали компромиссов

### Стало (v2.0):
- Адаптивная длина: **2-6 предложений**
- Длина подстраивается под сложность ситуации
- Возможность дать полный контекст для критических случаев

## Правило длины

### 2-3 предложения (короткие)
**Когда использовать:**
- Простые ситуации
- Дневник не заполнен (приоритет на напоминание)
- Один очевидный паттерн
- Всё идёт хорошо

**Примеры:**
```
Дима, 3 из 5 задач закрыл, +45 XP. Запиши в дневник, что помешало с двумя оставшимися?
```

```
5 из 5, streak 15 дней. Система работает.
```

### 4-5 предложений (средние)
**Когда использовать:**
- Есть важный паттерн, требующий объяснения
- Нужно показать связь между несколькими данными
- Выгорание или значительное падение показателей
- Противоречие между разными метриками

**Примеры:**
```
За неделю выполнение упало с 70% до 40%, здоровье снизилось до 3, и три дня подряд в дневнике про усталость. Это не лень — это сигнал, что организм просит паузу. Что сейчас поможет реально восстановиться?
```

```
4 из 8 — это 50%, но по факту было запланировано 7 часов при 4 свободных. Перегруз, а не провал. Третий день подряд ты планируешь больше, чем реально можешь сделать — может, пора честно оценить доступное время?
```

### 6 предложений (максимум, редко)
**Когда использовать:**
- Критическая ситуация требует детального разбора
- Сложный паттерн с несколькими уровнями
- Нужно дать контекст + гипотезу + вопрос
- Системная проблема (месяц застоя + перегруз + дисбаланс)

**Примеры:**
```
Месяц без движения по «Запуску MVP», при этом здоровье на 3 и completion rate 25% последние две недели. За это время закрыл 15 шагов, но все по мелким целям вроде «Навести порядок» и «Почитать книгу». Это классическое избегание через псевдопродуктивность. MVP страшный? Или на самом деле не нужен?
```

```
5 из 5 задач, все по «Порядку дома», но «Найти работу» стоит месяц на 5%. При этом работу ты сам отметил как более важную. Получается, делаешь то, что легче, а не то, что нужнее. Что в поиске работы блокирует — страшно, непонятно или просто тяжело начать?
```

## Технические изменения

### Системный промпт
- Добавлена секция "ПРАВИЛА ДЛИНЫ" с критериями выбора
- Обновлена структура с опциональным дополнительным контекстом
- Расширены примеры правильных уведомлений (11 вместо 7)

### User Prompt Template
- Обновлены требования к длине
- Добавлено правило выбора длины в зависимости от сложности

### Examples
- Добавлено 4 новых сценария (8-12)
- Примеры теперь показывают разную длину уведомлений
- Обновлён антипаттерн "слишком длинное" (теперь 8+ предложений)

### Integration JSON
- max_tokens увеличен с 200 до 300
- Добавлены примеры с длинными уведомлениями (4 и 5)
- Обновлены системный и юзер промпты

### README
- Обновлено описание системы
- Добавлены примеры с разной длиной
- Обновлена секция "Ключевые принципы"
- Добавлены параметры генерации в настройках

## Что НЕ изменилось

✅ **Сохранены ключевые принципы:**
- Дневник всегда в приоритете
- Один основной фокус на уведомление
- Конкретика (цифры, факты, названия)
- Стиль ментора (прямо, без клише)
- Без эмодзи
- Без мотивационных штампов

✅ **Структура остаётся той же:**
1. Факт дня
2. Основной инсайт
3. Дополнительный контекст (опционально)
4. Вопрос для рефлексии (опционально)

## Преимущества v2.0

1. **Гибкость:** Можно дать полный контекст для сложных случаев
2. **Точность:** Критические ситуации получают достаточно внимания
3. **Эффективность:** Простые случаи остаются краткими
4. **Естественность:** Длина соответствует важности сообщения

## Миграция с v1.0

**Код остаётся совместимым:**
- Старые уведомления (2-3 предложения) всё ещё валидны
- Просто увеличь max_tokens до 300
- AI сам выберет нужную длину на основе контекста

**Обновления в коде:**
```javascript
// Было
max_tokens: 200

// Стало
max_tokens: 300  // Поддержка до 6 предложений
```

## Рекомендации

1. **Мониторь длину:** Отслеживай среднюю длину уведомлений
2. **A/B тесты:** Сравни engagement для разных длин
3. **Feedback loop:** Собирай обратную связь о полезности длинных уведомлений
4. **Не злоупотребляй:** 6 предложений должны быть редкостью (10-15% случаев)

## Ожидаемое распределение

Примерное соотношение по длине (на основе паттернов):
- **2-3 предложения:** ~60% (простые случаи, дневник не заполнен)
- **4-5 предложений:** ~30% (комплексные паттерны)
- **6 предложений:** ~10% (критические ситуации)

## Проверка качества

Новый чек-лист для валидации уведомлений:
- [ ] Длина соответствует сложности ситуации?
- [ ] При 4+ предложениях — действительно нужен дополнительный контекст?
- [ ] Нет "воды" — каждое предложение несёт смысл?
- [ ] Основной фокус остаётся один?
- [ ] Стиль остаётся прямым и конкретным?

---

**Версия:** 2.0  
**Дата:** 24.12.2024  
**Обратная совместимость:** Да  
**Breaking changes:** Нет