# Comeback Notification — Документация

## Назначение

Comeback Notification — приветственное сообщение для пользователя, который вернулся после паузы (3+ дней без активности). Цель: тепло встретить и помочь легко начать снова.

**Почему это важно:** Пользователь, который вернулся сам — уже проявил интерес. Неправильный тон может оттолкнуть навсегда.

---

## Структура файлов

```
comeback_notification/
├── comeback_system_prompt.md    # Системный промпт
├── comeback_user_prompt.md      # User prompt с переменными
├── comeback_examples.md         # Примеры по категориям
└── README.md                    # Этот файл
```

---

## Триггер отправки

Уведомление отправляется когда:
- Пользователь открыл приложение
- С последней активности прошло ≥3 дней
- Это первый вход после паузы

```javascript
if (user.last_activity_date && daysSinceActivity >= 3 && !user.comeback_shown_today) {
  showComebackNotification(user);
  user.comeback_shown_today = true;
}
```

**Показывается:** Сразу при входе в приложение (как приветствие).

---

## Категории

| Категория | Отсутствие | Тон | Акцент |
|-----------|------------|-----|--------|
| **short** | 3-6 дней | Обычный | Продолжаем |
| **medium** | 7-13 дней | Мягкий | Хорошо что вернулся |
| **long** | 14+ дней | Тёплый | Как начать заново |

---

## Требуемые данные от бэкенда

| Переменная | Тип | Обязательно | Описание |
|------------|-----|-------------|----------|
| `user_name` | string | Да | Имя пользователя |
| `current_date` | string | Да | Текущая дата |
| `comeback.days_absent` | number | Да | Дней отсутствия |
| `comeback.absence_category` | string | Да | "short", "medium", "long" |
| `comeback.last_activity_date` | string | Да | Дата последней активности |
| `comeback.last_completed_task` | string/null | Нет | Последняя задача |
| `comeback.active_goals_count` | number | Нет | Количество целей |
| `comeback.was_on_streak` | boolean | Нет | Был на streak? |
| `current_tasks` | array | Нет | Текущие задачи |
| `active_habits` | array | Нет | Активные привычки |

### Логика определения категории

```javascript
function getAbsenceCategory(daysAbsent) {
  if (daysAbsent >= 14) return 'long';
  if (daysAbsent >= 7) return 'medium';
  return 'short';
}
```

---

## Отличие от Streak Recovery

| Аспект | Comeback | Streak Recovery |
|--------|----------|-----------------|
| Триггер | Любой вход после паузы | Потеря streak ≥7 дней |
| Фокус | Общее возвращение | Конкретная привычка |
| Тон | Приветствие | Поддержка |
| Действие | Любая задача | Вернуться к привычке |

**Важно:** Если пользователь потерял streak — он получит Streak Recovery отдельно. Comeback не должен упоминать потерянные streaks.

---

## Метрики успеха

| Метрика | Цель | Как измерять |
|---------|------|--------------|
| Engagement после comeback | >50% | % юзеров, совершивших действие после сообщения |
| Retention D+7 | >30% | % вернувшихся юзеров, активных через 7 дней |
| Churn после comeback | <40% | % юзеров, ушедших после возвращения |

---

## Принципы

1. **Тёплый приём** — рад видеть, без чрезмерных эмоций
2. **Без упрёков** — не спрашивать "где был"
3. **Лёгкий старт** — одно простое действие
4. **Без статистики потерь** — не показывать что упустил

---

## Changelog

| Дата | Версия | Изменения |
|------|--------|-----------|
| 2025-01-20 | 1.0 | Создана первая версия Comeback Notification |
