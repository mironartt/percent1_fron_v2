# Streak Recovery — Документация

## Назначение

Streak Recovery — уведомление при потере серии (streak) по привычке. Цель: вернуть пользователя без осуждения и давления.

**Почему это критично:** 44% пользователей уходят после потери streak. Это одна из главных точек оттока.

---

## Структура файлов

```
streak_recovery/
├── streak_recovery_system_prompt.md   # Системный промпт
├── streak_recovery_user_prompt.md     # User prompt с переменными
├── streak_recovery_examples.md        # Примеры по категориям
└── README.md                          # Этот файл
```

---

## Триггер отправки

Уведомление отправляется когда:
- Пользователь имел streak ≥ 7 дней
- Streak прервался (пропуск 1+ день)
- Прошло не более 7 дней с пропуска

```javascript
if (habit.previous_streak >= 7 && habit.current_streak === 0 && daysSinceBreak <= 7) {
  sendStreakRecovery(habit);
}
```

**Время отправки:** Утро (08:00-10:00) — когда есть шанс выполнить привычку сегодня.

---

## Категории

| Категория | Streak был | Тон | Акцент |
|-----------|------------|-----|--------|
| **short** | 7-14 дней | Лёгкий | Один день — не провал |
| **medium** | 15-30 дней | Уважительный | Это уже привычка |
| **long** | 30+ дней | Партнёрский | Это часть тебя |

---

## Требуемые данные от бэкенда

| Переменная | Тип | Обязательно | Описание |
|------------|-----|-------------|----------|
| `user_name` | string | Да | Имя пользователя |
| `current_date` | string | Да | Текущая дата |
| `streak_recovery.habit_title` | string | Да | Название привычки |
| `streak_recovery.streak_was` | number | Да | Какой был streak |
| `streak_recovery.days_since_break` | number | Да | Дней с пропуска |
| `streak_recovery.streak_category` | string | Да | "short", "medium", "long" |
| `streak_recovery.previous_longest` | number | Нет | Предыдущий рекорд |

### Логика определения категории

```javascript
function getStreakCategory(streakWas) {
  if (streakWas >= 30) return 'long';
  if (streakWas >= 15) return 'medium';
  return 'short';
}
```

---

## Варианты ответа (кнопки)

| Категория | Кнопки |
|-----------|--------|
| short | `[Да, продолжу]` `[Нужна пауза]` |
| medium | `[Продолжить]` |
| long | `[Продолжаю]` `[Расскажи что случилось]` |

**Обработка ответов:**
- "Продолжу/Продолжить/Продолжаю" → streak сбрасывается, пользователь продолжает
- "Нужна пауза" → отложить напоминание на 3 дня
- "Расскажи что случилось" → открыть чат с ментором

---

## Метрики успеха

| Метрика | Цель | Как измерять |
|---------|------|--------------|
| Recovery rate | >70% | % юзеров, вернувшихся после уведомления |
| Time to recovery | <24ч | Среднее время от уведомления до возврата |
| Churn after break | <30% | % юзеров, ушедших после потери streak |

---

## Принципы

1. **Никакого осуждения** — не спрашивать причину, не говорить "жаль"
2. **Нормализация** — один пропуск не обнуляет прогресс
3. **Признание** — серия была и она что-то значила
4. **Простой призыв** — легко вернуться

---

## Changelog

| Дата | Версия | Изменения |
|------|--------|-----------|
| 2025-01-20 | 1.0 | Создана первая версия Streak Recovery |
