# Предложения по улучшению фронтенда

## Обзор

Данный документ содержит предложения по улучшению UX/UI модалок и компонентов работы с целями. Все предложения разделены на **безопасные** (не требуют изменений бэкенда) и **требующие согласования** (нужны изменения API).

---

## Часть 1: Безопасные изменения (только фронтенд)

Эти изменения затрагивают только CSS/HTML и UI-состояния. API-вызовы и структуры данных остаются без изменений.

### 1.1 Мобильная адаптация модалок

**Проблема:** На мобильных устройствах модалки отображаются по центру экрана, что неудобно для взаимодействия одной рукой.

**Решение:**
- Bottom sheet вместо центрированной модалки на экранах < 640px
- Drag handle (полоска сверху) для визуального индикатора
- Swipe-to-close — закрытие свайпом вниз
- Скругление только верхних углов

**Затронутые компоненты:**
- `AddGoalModal.vue` ✅ Уже реализовано
- `MentorGoalSuggestionsModal.vue` ✅ Уже реализовано
- `GoalsBank.vue` (Edit Modal) ✅ Уже реализовано
- `GoalEdit.vue` (Step Edit Bottom Sheet) — в очереди

### 1.2 Collapsible выбор сферы жизни

**Проблема:** Сетка из 6 сфер занимает много места и визуально перегружает интерфейс.

**Решение:**
- По умолчанию показывается компактная кнопка "Выбрать сферу"
- При клике раскрывается список chips с названиями сфер
- После выбора список сворачивается, показывается выбранная сфера

**Статус:** ✅ Реализовано в AddGoalModal и GoalsBank Edit Modal

### 1.3 Унификация стилей модалок

**Проблема:** Разные модалки имеют разный визуальный стиль (кнопки, отступы, шрифты).

**Решение:**
- Единый дизайн-токены для всех модалок
- Консистентные отступы (1.25rem padding)
- Одинаковые стили кнопок действий
- Единый формат заголовков

### 1.4 Улучшение Quick Actions в Edit Modal

**Проблема:** Кнопки действий ("В работу", "Шаги", "Завершить") на мобильных скрывали текст, оставляя только иконки — непонятно назначение.

**Решение:**
- Горизонтальный скролл вместо переноса строк
- Текст всегда виден
- Переименование "Шаги" → "Декомпозиция" для ясности

**Статус:** ✅ Реализовано

### 1.5 Teleport для модалок

**Проблема:** Модалки внутри компонентов могут иметь проблемы с z-index из-за stacking context родителей.

**Решение:**
- Использование `<Teleport to="body">` для рендеринга модалок в конце DOM
- Гарантированный z-index поверх всего контента

**Статус:** ✅ Реализовано в переделанных модалках

---

## Часть 2: Изменения, требующие согласования с бэкендом

Эти изменения затрагивают структуру данных или API. Необходимо согласование и возможные изменения на бэкенде.

### 2.1 Упрощение полей мотивации (3 поля → 1)

**Текущая структура:**
```javascript
// Фронтенд хранит
{
  whyImportant: string,
  threeWhys: {
    why1: string,  // Почему это важно?
    why2: string,  // Что это мне даст?
    why3: string   // Почему это про меня?
  }
}

// Отправляется на бэкенд
{
  why_important: string,
  why_give_me: string,
  why_about_me: string
}
```

**Проблема:**
- Пользователи редко заполняют все 3 поля
- UI перегружен вопросами
- Часто дублируется информация между полями

**Предложение:**
Объединить в одно поле "Мотивация" с подсказкой, включающей все три вопроса.

**Вопрос к бэкенду:**
1. Можно ли сделать `why_give_me` и `why_about_me` опциональными (могут быть пустыми)?
2. Или нужен новый единый эндпоинт/поле?
3. Есть ли зависимости в аналитике/отчётах от этих полей?

### 2.2 Статусы целей — текущий маппинг

**Текущая логика (для справки, менять не предлагается):**

```javascript
// Фронтенд статус → Бэкенд score
'validated' → score: 'true'
'rejected'  → score: 'false'
'raw'       → score: null

// Фронтенд workStatus → Бэкенд status
'work'     → status: 'work'
'complete' → status: 'complete'
null       → status: null
```

**Вопрос:**
Планируются ли новые статусы целей в будущем (например, "архив", "отложено")?

### 2.3 Категории (сферы жизни) — текущий маппинг

```javascript
// Фронтенд → Бэкенд
wealth     → welfare
hobbies    → hobby
friendship → environment
health     → health_sport
career     → work
love       → family
```

**Замечание:**
Маппинг работает, но названия на фронтенде и бэкенде отличаются. При добавлении новых сфер нужно обновлять маппинг в двух местах:
- `src/stores/app.js` — `categoryFrontendToBackend` и `categoryBackendToFrontend`

---

## Часть 3: Текущее состояние API

### 3.1 Эндпоинты целей

```
POST /api/rest/front/app/goals/update/
```

**Тело запроса:**
```javascript
{
  goals_data: [{
    goal_id: number | null,      // null = создание, число = обновление
    title: string,               // Название цели
    category: string,            // welfare|hobby|environment|health_sport|work|family
    score: 'true'|'false'|null,  // Валидация цели
    status: 'work'|'complete'|null,  // Статус работы
    why_important: string,       // Почему важно
    why_give_me: string,         // Что даст
    why_about_me: string         // Почему про меня
  }],
  deleted_goals_ids: [number],   // ID для удаления
  completed_goals_ids: [number]  // ID для завершения
}
```

### 3.2 Эндпоинты шагов

```
POST /api/rest/front/app/goals/steps/update/
```

**Тело запроса:**
```javascript
{
  goals_steps_data: [{
    goal_id: number,             // ID цели (обязательный)
    step_id: number | null,      // null = создание
    title: string,               // Название шага
    description: string,         // Комментарий
    priority: 'critical'|'important'|'attention'|'optional',
    time_duration: 'half'|'one'|'two'|'three'|'four',
    dt: 'YYYY-MM-DD',           // Дата
    order: number,               // Порядок
    is_complete: boolean,
    is_deleted: boolean
  }]
}
```

---

## Часть 4: Следующие шаги

### Уже выполнено:
1. ✅ Редизайн `AddGoalModal.vue`
2. ✅ Редизайн `MentorGoalSuggestionsModal.vue`
3. ✅ Редизайн Edit Modal в `GoalsBank.vue`

### В очереди (только UI):
4. ⏳ Редизайн Step Edit в `GoalEdit.vue`
5. ⏳ Унификация остальных модалок

### Требуют решения бэкенда:
6. ❓ Упрощение полей мотивации (why1/why2/why3)

---

## Вопросы к бэкенд-разработчику

1. **Поля мотивации:** Можно ли оставлять `why_give_me` и `why_about_me` пустыми без ошибок? Или они обязательны?

2. **Будущие изменения:** Планируются ли изменения в структуре целей/шагов? Если да, какие?

3. **Валидация:** Есть ли серверная валидация на обязательность полей? Какие поля реально обязательны?

4. **Аналитика:** Используются ли поля `why_give_me` и `why_about_me` в аналитике/ML? Можно ли их объединить?

---

*Документ создан: 2025-01-19*
*Автор: Frontend Team*
